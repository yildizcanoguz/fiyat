<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÅžANTÄ°YE YÃ–NETÄ°M (FULL+MAKÄ°NE)</title>
    <style>
        /* --- MODERN TASARIM --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; padding: 0; background-color: #f4f6f8; color: #333; 
            height: 100vh; display: flex; flex-direction: column;
        }

        /* GÄ°RÄ°Åž EKRANI */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #f4f6f8 0%, #dbe2e8 100%);
            z-index: 99999; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .login-box {
            background: white; padding: 40px 30px; border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1); width: 85%; max-width: 350px;
            text-align: center; border: 1px solid #fff;
        }
        .login-input {
            width: 100%; padding: 15px; margin: 20px 0; border: 2px solid #e1e4e8; 
            border-radius: 12px; font-size: 24px; text-align: center; letter-spacing: 5px; 
            background: #f9fbfd; transition: all 0.3s;
        }
        .login-input:focus { border-color: #007aff; background: #fff; }
        .login-btn {
            width: 100%; padding: 15px; background: #2c3e50; color: white;
            border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer;
            box-shadow: 0 5px 15px rgba(44, 62, 80, 0.3);
        }

        /* ANA UYGULAMA */
        #appContainer {
            display: none; width: 100%; max-width: 800px; margin: 0 auto; height: 100%; 
            overflow-y: auto; padding: 15px; padding-bottom: 160px;
        }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .app-title { font-size: 18px; font-weight: 900; color: #2c3e50; text-transform: uppercase; }
        .logout-btn { background: #ff3b30; color: white; border: none; padding: 6px 12px; border-radius: 8px; font-size: 11px; font-weight: 700; cursor: pointer; }

        /* PARAMETRELER */
        .params-bar {
            background: #fff; padding: 10px; border-radius: 12px; margin-bottom: 15px;
            display: flex; gap: 10px; border: 1px solid #e1e4e8;
        }
        .p-group { flex: 1; }
        .p-label { font-size: 10px; font-weight: bold; color: #888; display: block; margin-bottom: 3px; }
        .p-input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; text-align: center; font-weight: bold; font-size: 14px; }

        /* BÃ–LÃœM KUTULARI */
        .section-card {
            background: white; border-radius: 16px; padding: 15px; margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.03); border: 1px solid #e1e4e8;
        }
        .sec-header { 
            font-size: 13px; font-weight: 800; color: #555; margin-bottom: 15px; 
            border-bottom: 1px solid #eee; padding-bottom: 8px; display: flex; justify-content: space-between;
        }

        /* DROPBOX ARAMA */
        .search-container { position: relative; margin-bottom: 15px; z-index: 100; }
        .search-box-wrapper {
            display: flex; align-items: center; background: #f9fbfd; border: 2px solid #ddd;
            border-radius: 12px; overflow: visible; transition: 0.3s;
        }
        .search-box-wrapper.blue-border { border-color: #007aff; }
        .search-box-wrapper.orange-border { border-color: #e67e22; }

        .search-input { width: 100%; padding: 14px; border: none; background: transparent; font-size: 14px; font-weight: 600; outline:none; }
        .dropdown-icon { padding: 0 15px; font-size: 12px; cursor: pointer; font-weight: bold; }
        
        .results-list {
            display: none; position: absolute; top: 110%; left: 0; right: 0;
            background: white; border-radius: 12px; max-height: 300px; overflow-y: auto;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2); border: 1px solid #e1e4e8; z-index: 9999;
        }
        .res-item { padding: 12px; border-bottom: 1px solid #f0f0f0; cursor: pointer; font-size: 12px; line-height: 1.4; display: flex; justify-content: space-between;}
        .res-item:hover { background: #f0f7ff; }
        .res-item strong { color: #007aff; display: block; }
        .machine-tag { background: #e67e22; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; }

        /* HESAPLAMA ALANI */
        .calc-grid { display: flex; gap: 10px; margin-bottom: 10px; }
        .calc-box label { font-size: 10px; font-weight: bold; color: #888; display: block; }
        .calc-inp { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-weight: bold; text-align: center; }
        .total-display { 
            background: #eaf3ff; color: #007aff; padding: 12px; border-radius: 8px; 
            text-align: right; font-size: 18px; font-weight: 900; 
        }
        .analysis-note { font-size: 11px; color: #27ae60; margin-top: 5px; font-style: italic; display: none; }

        /* MALÄ°YETLER */
        .cost-row { display: flex; gap: 5px; margin-bottom: 8px; align-items: center; }
        .c-name { flex: 2; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 13px; }
        .c-val { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 13px; text-align: center; }
        .c-del { width: 28px; height: 28px; background: #ffebec; color: red; border: none; border-radius: 50%; font-weight: bold; cursor: pointer; }
        
        .add-btn { 
            width: 100%; padding: 10px; background: #fff; color: #7f8c8d; border: 2px dashed #ccc; 
            border-radius: 10px; font-weight: 800; cursor: pointer; margin-top: 10px; font-size: 13px;
        }

        /* ALT TOPLAM Ã‡UBUÄžU */
        .footer-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; background: white;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1); padding: 15px; z-index: 999;
            display: flex; justify-content: space-between; align-items: center;
            border-top: 1px solid #eee;
        }
        .f-item { text-align: center; flex: 1; }
        .f-lbl { font-size: 10px; color: #888; font-weight: 800; display: block; }
        .f-val { font-size: 14px; font-weight: 800; color: #333; }
        .f-profit { font-size: 18px; font-weight: 900; }
        .pos { color: #27ae60; } .neg { color: #ff3b30; }

    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-box">
        <h3>ÅžANTÄ°YE YÃ–NETÄ°M</h3>
        <input type="password" id="passInput" class="login-input" placeholder="****" inputmode="numeric">
        <button class="login-btn" onclick="app.login()">GÄ°RÄ°Åž YAP</button>
    </div>
</div>

<div id="appContainer">
    <div class="header">
        <div class="app-title">HAKEDÄ°Åž & MALÄ°YET</div>
        <button class="logout-btn" onclick="app.logout()">Ã‡IKIÅž</button>
    </div>

    <div class="params-bar">
        <div class="p-group">
            <label class="p-label">MAZOT (DZD)</label>
            <input type="number" id="dieselPrice" class="p-input" value="29.01" onkeyup="app.recalc()">
        </div>
        <div class="p-group">
            <label class="p-label">EURO KURU</label>
            <input type="number" id="euroRate" class="p-input" value="107.31" onkeyup="app.recalc()">
        </div>
    </div>

    <div class="section-card" style="border-left: 4px solid #007aff;">
        <div class="sec-header">
            <span>1. HAKEDÄ°Åž (GELÄ°R)</span>
            <span id="unitBadge" style="background:#007aff; color:white; padding:2px 8px; border-radius:4px; font-size:10px;">BÄ°RÄ°M</span>
        </div>
        
        <label style="font-size:10px; font-weight:bold; color:#007aff;">Ä°Åž KALEMÄ° SEÃ‡Ä°NÄ°Z:</label>
        <div class="search-container">
            <div class="search-box-wrapper blue-border">
                <input type="text" id="searchBox" class="search-input" placeholder="Poz Ara..." onkeyup="app.filterList('item')" onclick="app.toggleList('item')" autocomplete="off">
                <div class="dropdown-icon" onclick="app.toggleList('item')">â–¼</div>
            </div>
            <div id="itemList" class="results-list"></div>
        </div>

        <div class="calc-grid">
            <div class="calc-box" style="flex:1;">
                <label>SÃ¶zleÅŸme FiyatÄ± (DZD)</label>
                <input type="text" id="priceDisplay" class="calc-inp" readonly placeholder="0.00" style="background:#f9f9f9;">
            </div>
            <div class="calc-box" style="flex:1;">
                <label>YapÄ±lan Miktar</label>
                <input type="number" id="qtyInput" class="calc-inp" placeholder="0" onkeyup="app.calcRevenue()">
            </div>
        </div>
        
        <div id="revenueTotal" class="total-display">0.00 DZD</div>
        <div id="analysisInfo" class="analysis-note">ðŸ’¡ Otomatik analiz verisi eklendi.</div>
    </div>

    <div class="section-card" style="border-left: 4px solid #e67e22;">
        <div class="sec-header">
            <span>2. MALÄ°YETLER (GÄ°DER)</span>
            <span id="costCount" style="color:#e67e22;">0 Kalem</span>
        </div>
        
        <label style="font-size:10px; font-weight:bold; color:#e67e22;">KÄ°RALIK MAKÄ°NE EKLE:</label>
        <div class="search-container">
            <div class="search-box-wrapper orange-border">
                <input type="text" id="machineBox" class="search-input" placeholder="Makine SeÃ§ (EkskavatÃ¶r...)" onkeyup="app.filterList('machine')" onclick="app.toggleList('machine')" autocomplete="off">
                <div class="dropdown-icon" onclick="app.toggleList('machine')">â–¼</div>
            </div>
            <div id="machineList" class="results-list"></div>
        </div>

        <div id="costContainer"></div>

        <button class="add-btn" onclick="app.addCostRow()">+ Manuel Gider Ekle</button>
    </div>

    <div style="text-align:center; margin-top:20px; color:#999; font-style:italic; font-size:12px;" id="dailyQuote">...</div>

</div>

<div class="footer-bar" id="footerBar" style="display:none;">
    <div class="f-item">
        <span class="f-lbl">HAKEDÄ°Åž</span>
        <span class="f-val" id="sumRev" style="color:#007aff;">0</span>
    </div>
    <div class="f-item">
        <span class="f-lbl">MALÄ°YET</span>
        <span class="f-val" id="sumCost" style="color:#e67e22;">0</span>
    </div>
    <div class="f-item">
        <span class="f-lbl">KÃ‚R / ZARAR</span>
        <span class="f-profit" id="sumProfit">0</span>
    </div>
</div>

<script>
    var app = {
        PASS: "1907",
        selItem: null,
        totalRev: 0,
        totalCost: 0,

        // --- 1. TAM Ä°Åž KALEMLERÄ° LÄ°STESÄ° (268 Kalem) ---
        // a: Analiz verisi (varsa) -> {m:Makine, f:YakÄ±t, l:Ä°ÅŸÃ§ilik, mat:Malzeme, prod:Ãœretim}
        dbItems: [
            { code: "A.1", name: "Installation et repliement / Åžantiye Kurulumu", unit: "Ft", price: 1041277260.86 },
            { code: "A.2.1", name: "Laboratoire de chantier / Åžantiye LaboratuvarÄ±", unit: "Ft", price: 41644039.15 },
            { code: "A.2.2", name: "ContrÃ´le externe / DÄ±ÅŸ Kontrol", unit: "Ft", price: 33983960.76 },
            { code: "A.3.1", name: "Ã‰tudes d'exÃ©cution / Uygulama Projeleri", unit: "Ft", price: 212842500.00 },
            { code: "A.3.2", name: "ContrÃ´le externe des Ã©tudes / Proje KontrolÃ¼", unit: "Ft", price: 45999996.83 },
            { code: "A.3.3", name: "Dossier de rÃ©colement / As-built", unit: "Ft", price: 33568500.00 },
            { code: "A.3.4", name: "Ã‰tude des mÃ©thodes / Metodoloji", unit: "Ft", price: 7500069.87 },
            { code: "A.3.5", name: "Reconnaissances gÃ©otechniques / Jeoteknik", unit: "Ft", price: 40209555.68 },
            { code: "A.4.1", name: "SÃ©curitÃ© passive", unit: "Ft", price: 200000000.00 },
            { code: "A.4.2", name: "SÃ©curitÃ© active", unit: "Ft", price: 400000000.00 },
            { code: "A.5", name: "Panneau identification", unit: "U", price: 1775000.00 },
            { code: "B.1.1", name: "DÃ©broussaillage / Ã‡alÄ± TemizliÄŸi", unit: "Ha", price: 619820.41 },
            { code: "B.1.2", name: "Abattage arbres", unit: "U", price: 1600.00 },
            { code: "B.1.3", name: "DÃ©pose ouvrages", unit: "Tonne", price: 944.25 },
            { code: "B.2.1", name: "DÃ©molition divers", unit: "m3", price: 1335.05 },
            { code: "B.2.2", name: "DÃ©molition bÃ©ton", unit: "m3", price: 1620.22 },
            { code: "B.2.3", name: "DÃ©molition chaussÃ©e", unit: "m3", price: 207.70 },
            { code: "B.3.1", name: "Rabotage <10cm", unit: "m2", price: 88.85 },
            { code: "B.3.2", name: "Rabotage 10-20cm", unit: "m2", price: 98.62 },
            { code: "B.4", name: "Scarification", unit: "m2", price: 28.16 },
            { code: "C.1.1", name: "DÃ©capage / SÄ±yÄ±rma", unit: "m3", price: 128.62, a:{m:300, f:150, l:100, mat:0, prod:4000} },
            { code: "C.1.2", name: "Reprise stock", unit: "m3", price: 179.08 },
            { code: "C.2.2", name: "Purges", unit: "m3", price: 2200.00 },
            { code: "C.3.1", name: "DÃ©blai meuble / YumuÅŸak KazÄ±", unit: "m3", price: 257.24, a:{m:450, f:280, l:150, mat:0, prod:3600} },
            { code: "C.3.2", name: "DÃ©blai semi-dur / KÃ¼skÃ¼lÃ¼k KazÄ±", unit: "m3", price: 386.32 },
            { code: "C.3.3", name: "DÃ©blai rocheux / Kaya KazÄ±", unit: "m3", price: 1308.96, a:{m:850, f:450, l:250, mat:0, prod:1200} },
            { code: "C.4.1", name: "DÃ©blai meuble dÃ©pÃ´t", unit: "m3", price: 148.16 },
            { code: "C.4.2", name: "DÃ©blai semi-dur dÃ©pÃ´t", unit: "m3", price: 307.70 },
            { code: "C.4.3", name: "DÃ©blai rocheux dÃ©pÃ´t", unit: "m3", price: 893.10 },
            { code: "C.5.1", name: "Remblai emprunt / Ariyet", unit: "m3", price: 555.63, a:{m:600, f:350, l:180, mat:0, prod:1800} },
            { code: "C.6.1", name: "Assise drainante", unit: "m3", price: 1166.55 },
            { code: "C.7.1", name: "GÃ©otextile renfort", unit: "m2", price: 290.80 },
            { code: "C.7.2", name: "GÃ©otextile anti-contam", unit: "m2", price: 258.27 },
            { code: "C.7.3", name: "GÃ©ogrille", unit: "m2", price: 418.04 },
            { code: "C.8.1", name: "Arrondi crÃªte", unit: "ml", price: 317.01 },
            { code: "C.9.1", name: "Couche forme (CDF)", unit: "m3", price: 1346.55, a:{m:500, f:300, l:150, mat:0.5, prod:1500} },
            { code: "C.10.1", name: "Transport < 30km", unit: "M3xKM", price: 12.50 },
            { code: "C.10.2", name: "Transport > 30km", unit: "M3xKM", price: 11.00 },
            { code: "D.1.1", name: "FossÃ© A", unit: "ml", price: 495.86 },
            { code: "D.1.2", name: "FossÃ© B", unit: "ml", price: 594.94 },
            { code: "D.1.3", name: "FossÃ© C", unit: "ml", price: 897.18 },
            { code: "D.1.4", name: "VÃ©gÃ©talisation", unit: "ml", price: 874.94 },
            { code: "D.2.1", name: "BÃ©tonnage A", unit: "ml", price: 4448.37 },
            { code: "D.2.2", name: "BÃ©tonnage B", unit: "ml", price: 5662.50 },
            { code: "D.2.3", name: "BÃ©tonnage C", unit: "ml", price: 6316.17 },
            { code: "D.3.1", name: "Cunette vÃ©gÃ©talisÃ©e", unit: "ml", price: 3402.40 },
            { code: "D.3.2", name: "Cunette bÃ©ton", unit: "ml", price: 4304.81 },
            { code: "D.3.3", name: "Cunette symÃ©trique", unit: "ml", price: 4829.18 },
            { code: "D.4.1", name: "Descente A", unit: "ml", price: 2912.86 },
            { code: "D.4.2", name: "Descente B", unit: "ml", price: 3357.57 },
            { code: "D.4.3", name: "Descente C", unit: "ml", price: 3634.81 },
            { code: "D.4.4", name: "Descente D", unit: "ml", price: 4119.98 },
            { code: "D.5.1", name: "Descente tuile A", unit: "ml", price: 2200.00 },
            { code: "D.5.2", name: "Descente tuile B", unit: "ml", price: 3520.00 },
            { code: "D.5.3", name: "Descente tuile C", unit: "ml", price: 4200.00 },
            { code: "D.6.1", name: "Caniveau U 30x40", unit: "ml", price: 4800.00 },
            { code: "D.6.2", name: "Caniveau U 40x50", unit: "ml", price: 5800.00 },
            { code: "D.6.3", name: "Caniveau U 45x55", unit: "ml", price: 6300.00 },
            { code: "D.7.1", name: "Caniveau fente 300", unit: "ml", price: 22200.00 },
            { code: "D.7.2", name: "Caniveau fente 400", unit: "ml", price: 26600.00 },
            { code: "D.7.3", name: "Caniveau fente 500", unit: "ml", price: 29300.00 },
            { code: "D.7.4", name: "Renforcement", unit: "ml", price: 11191.83 },
            { code: "D.8.1", name: "Demi-buse 300", unit: "ml", price: 4400.00 },
            { code: "D.8.2", name: "Demi-buse 400", unit: "ml", price: 5700.00 },
            { code: "D.8.3", name: "Demi-buse 500", unit: "ml", price: 7800.00 },
            { code: "D.9.1", name: "DÃ©blai tranchÃ©e <2m", unit: "m3", price: 217.93 },
            { code: "D.9.2", name: "TranchÃ©e 2-4m", unit: "m3", price: 277.24 },
            { code: "D.9.3", name: "TranchÃ©e 4-6m", unit: "m3", price: 326.55 },
            { code: "D.9.4", name: "PV Roche tranchÃ©e", unit: "m3", price: 1500.00 },
            { code: "D.10.1", name: "Lit sable", unit: "m3", price: 1455.51 },
            { code: "D.10.2", name: "Lit bÃ©ton", unit: "m3", price: 5962.17 },
            { code: "D.11.1", name: "Enrobage grave", unit: "m3", price: 1437.35 },
            { code: "D.11.2", name: "Enrobage bÃ©ton", unit: "m3", price: 5593.89 },
            { code: "D.11.3", name: "Enrobage drainant", unit: "m3", price: 1739.65 },
            { code: "D.12.1", name: "Tuyau 400mm / BA Boru", unit: "ml", price: 7769.31 },
            { code: "D.12.2", name: "Tuyau 600mm / BA Boru", unit: "ml", price: 9369.31 },
            { code: "D.13.1", name: "Buse 800mm / BA BÃ¼z", unit: "ml", price: 15498.73 },
            { code: "D.13.2", name: "Buse 1000mm / BA BÃ¼z", unit: "ml", price: 21631.72 },
            { code: "D.13.3", name: "Buse 1200mm / BA BÃ¼z", unit: "ml", price: 36375.97 },
            { code: "D.13.4", name: "Buse 1500mm / BA BÃ¼z", unit: "ml", price: 50775.97 },
            { code: "D.14.1", name: "Collecteur 150mm", unit: "ml", price: 2700.00 },
            { code: "D.17.1", name: "Tuyau PEHD 75mm", unit: "ml", price: 1236.00 },
            { code: "D.17.2", name: "Tuyau PEHD 90mm", unit: "ml", price: 1500.00 },
            { code: "D.18.1", name: "Chambre K1C", unit: "U", price: 112000.00 },
            { code: "D.18.2", name: "Chambre K2C", unit: "U", price: 125000.00 },
            { code: "D.19.1", name: "Regard 1000mm", unit: "U", price: 120000.00 },
            { code: "D.20.1", name: "Puisard / Rogar", unit: "U", price: 150000.00 },
            { code: "D.20.2", name: "Puisard 1300", unit: "U", price: 174000.00 },
            { code: "D.20.3", name: "Puisard 1500", unit: "U", price: 188000.00 },
            { code: "D.20.4", name: "Puisard 1800", unit: "U", price: 215000.00 },
            { code: "D.20.5", name: "Puisard 2000", unit: "U", price: 220000.00 },
            { code: "D.20.6", name: "Puisard 2500", unit: "U", price: 260000.00 },
            { code: "D.21.1", name: "Grille 700x700", unit: "U", price: 32000.00 },
            { code: "D.21.2", name: "Grille 250x400", unit: "U", price: 26826.09 },
            { code: "D.21.3", name: "Caillebotis 1x1m", unit: "U", price: 5400.00 },
            { code: "D.21.4", name: "Caillebotis 1x2m", unit: "U", price: 9200.00 },
            { code: "D.22.1", name: "TÃªte buse 600", unit: "U", price: 60925.34 },
            { code: "D.22.2", name: "TÃªte buse 800", unit: "U", price: 68921.05 },
            { code: "D.22.3", name: "TÃªte buse 1000", unit: "U", price: 76992.73 },
            { code: "D.22.4", name: "TÃªte buse 1200", unit: "U", price: 90558.06 },
            { code: "D.22.5", name: "TÃªte buse 1500", unit: "U", price: 125386.97 },
            { code: "D.23.1", name: "Bourrelet", unit: "ml", price: 3000.00 },
            { code: "D.24.1", name: "Enrochement A", unit: "m3", price: 1879.30 },
            { code: "D.24.2", name: "Enrochement B", unit: "m3", price: 1879.30 },
            { code: "D.24.3", name: "Enrochement C", unit: "m3", price: 1879.30 },
            { code: "D.25.1", name: "Enrochement liÃ©", unit: "m3", price: 2042.98 },
            { code: "D.26.1", name: "Barbacane", unit: "ml", price: 1700.00 },
            { code: "D.27.1", name: "BÃ©ton propretÃ©", unit: "m3", price: 178.16 },
            { code: "D.27.2", name: "BÃ©ton ouvrages", unit: "m3", price: 9553.28 },
            { code: "D.27.3", name: "Coffrage", unit: "m2", price: 920.22 },
            { code: "D.27.4", name: "Ferraillage", unit: "kg", price: 65.08 },
            { code: "E.1.1", name: "Grave GNT / PMT", unit: "m3", price: 1922.64, a:{m:200, f:100, l:100, mat:3, prod:100} },
            { code: "E.2.1", name: "Grave Bitume GB", unit: "Tonne", price: 3390.32 },
            { code: "E.2.2", name: "EnrobÃ©s EME 2", unit: "Tonne", price: 4782.15 },
            { code: "E.3.1", name: "Couche BB / AÅŸÄ±nma", unit: "Tonne", price: 4337.90 },
            { code: "E.4.1", name: "ImprÃ©gnation", unit: "m2", price: 95.00 },
            { code: "E.5.1", name: "Bicouche", unit: "m2", price: 540.00 },
            { code: "E.6.1", name: "Bordure A2", unit: "ml", price: 2000.00 },
            { code: "F.1.1", name: "Hachures", unit: "m2", price: 680.00 },
            { code: "F.1.2", name: "Bande 100mm", unit: "ml", price: 70.00 },
            { code: "F.1.3", name: "Bande 150mm", unit: "ml", price: 145.00 },
            { code: "F.1.4", name: "Bande 225mm", unit: "ml", price: 200.00 },
            { code: "F.1.5", name: "Bande 375mm", unit: "ml", price: 340.00 },
            { code: "F.1.6", name: "Bande 500mm", unit: "ml", price: 420.00 },
            { code: "F.1.7", name: "FlÃ¨che rabattement", unit: "U", price: 600.00 },
            { code: "F.1.8", name: "FlÃ¨che simple", unit: "U", price: 800.00 },
            { code: "F.1.9", name: "FlÃ¨che double", unit: "U", price: 820.00 },
            { code: "F.2.1", name: "Bande prÃ©fa.", unit: "ml", price: 800.00 },
            { code: "G.1.1", name: "Panneau A/AB", unit: "U", price: 52000.00 },
            { code: "G.5.1", name: "Poteaux < 50", unit: "ml", price: 9776.59 },
            { code: "G.7.1", name: "RÃ©flecteur", unit: "U", price: 1670.00 },
            { code: "H.1.1.1", name: "GlissiÃ¨re GS4", unit: "ml", price: 1238.45 },
            { code: "H.2.1.1", name: "BarriÃ¨re GBA", unit: "ml", price: 3932.51 },
            { code: "I.1.1", name: "Fouilles murs", unit: "m3", price: 178.16 },
            { code: "I.1.3", name: "BÃ©ton propretÃ©", unit: "m3", price: 5919.19 },
            { code: "I.1.6", name: "BÃ©ton fondations", unit: "m3", price: 8973.98 },
            { code: "I.3.1", name: "Panneaux antibruit", unit: "m2", price: 88750.00 },
            { code: "I.5.3", name: "Enrochement / TaÅŸ Tahkimat", unit: "m3", price: 2205.85, a:{m:400, f:200, l:150, mat:5, prod:120} },
            { code: "I.6.1", name: "SÃ©parateur hydro.", unit: "U", price: 4400000.00 },
            { code: "I.8.1", name: "ClÃ´tures", unit: "ml", price: 5934.02 },
            { code: "I.9.1", name: "Plantation arbres", unit: "m2", price: 1545.17 },
            { code: "J.1.1", name: "Mur gabions", unit: "m3", price: 3034.57 },
            { code: "J.2.1", name: "BÃ©ton projetÃ©", unit: "m3", price: 13478.48 },
            { code: "J.2.3.1", name: "Clous 12m", unit: "U", price: 19236.87 },
            { code: "J.6.1", name: "Drains", unit: "ml", price: 4700.00 },
            { code: "J.8.1", name: "Ancrages 32mm", unit: "ml", price: 470.10 },
            { code: "J.11", name: "Atalus", unit: "m2", price: 18500.00 },
            { code: "J.12.1", name: "Terre ArmÃ©e / Toprakarme", unit: "m2", price: 13600.00, a:{m:500, f:300, l:400, mat:0, prod:1000} },
            { code: "K.1.1", name: "CamÃ©ra", unit: "U", price: 412003.51 },
            { code: "NP.48", name: "DÃ©placement cimetiÃ¨re", unit: "U", price: 22275.00 },
            { code: "OUA.B.1.1", name: "DÃ©blais fouilles / Temel KazÄ±sÄ±", unit: "m3", price: 178.16, a:{m:400, f:200, l:150, mat:0, prod:800} },
            { code: "OUA.B.2.1", name: "Pieux 1200 mm", unit: "ml", price: 5404.19 },
            { code: "OUA.B.5.2.1", name: "BÃ©ton C40", unit: "m3", price: 21343.02 },
            { code: "OUA.B.6.1.1", name: "Acier HA / Demir", unit: "Tonne", price: 67033.93, a:{m:50, f:20, l:400, mat:350, prod:10} },
            { code: "OUA.B.6.1.2", name: "Treillis soudÃ©s / HasÄ±r Ã‡elik", unit: "Tonne", price: 69026.52, a:{m:40, f:15, l:300, mat:480, prod:12} },
            { code: "OUA.B.6.2", name: "PrÃ©contrainte", unit: "Tonne", price: 55688.54 },
            { code: "OUA.B.7.1.1", name: "Appareil 2100", unit: "U", price: 260001.71 },
            { code: "OUA.B.7.5.1", name: "Joint 240mm", unit: "ml", price: 9389.70 },
            { code: "OUA.C.1", name: "Palplanches", unit: "m2", price: 25000.00 },
            { code: "OUA.NP.06", name: "Isolateur sismique", unit: "U", price: 134282.61 },
            { code: "OUA.NP.09a", name: "Tirants 45T / Ankraj 45T", unit: "ml", price: 4260.00, a:{m:350, f:100, l:250, mat:45, prod:40} },
            { code: "OUA.NP.08.41", name: "Drain perforÃ©", unit: "ml", price: 2700.00 },
            { code: "OUA.D26.1", name: "Barbacane / Barbakan", unit: "ml", price: 1700, a:{m:50, f:10, l:80, mat:2, prod:150} },
            { code: "TUN.E.1.1", name: "Fondation GNT", unit: "m3", price: 1862.41 },
            { code: "TUN.E.1.3", name: "EnrobÃ© EME", unit: "Tonne", price: 4812.84 },
            { code: "TUN.C.1.2", name: "DÃ©blais explosif", unit: "m3", price: 4883.43 },
            { code: "TUN.C.3.1", name: "Boulons 4m", unit: "U", price: 2832.82 },
            { code: "TUN.D.2.1", name: "BÃ©ton projetÃ© / Shotcrete", unit: "m3", price: 13046.21, a:{m:650, f:250, l:300, mat:65, prod:80} },
            { code: "TUN.F.2.1", name: "Ventilateurs", unit: "U", price: 459359.84 },
            { code: "TU.E.3.1.1", name: "Panneau Tunnel", unit: "U", price: 11768.62 }
        ],

        // --- 2. KÄ°RALIK MAKÄ°NE LÄ°STESÄ° ---
        dbMachines: [
            { name: "EkskavatÃ¶r", price: 40000 },
            { name: "Bulldozer", price: 50000 },
            { name: "Greyder", price: 45000 },
            { name: "Loader", price: 35000 },
            { name: "Paletli Loader", price: 40000 },
            { name: "KompaktÃ¶r (Silindir)", price: 20000 },
            { name: "Kamyon", price: 17000 },
            { name: "JCB", price: 10000 },
            { name: "TÄ±r", price: 25000 },
            { name: "Lowbed", price: 30000 },
            { name: "ArazÃ¶z", price: 20000 },
            { name: "Shotcrete Makinesi", price: 40000 },
            { name: "Enjeksiyon Makinesi", price: 10000 }
        ],

        // --- GÄ°RÄ°Åž ---
        login: function() {
            if(document.getElementById("passInput").value === this.PASS) {
                document.getElementById("loginOverlay").style.display = "none";
                document.getElementById("appContainer").style.display = "block";
                document.getElementById("footerBar").style.display = "flex";
                this.addCostRow(); 
                this.quote();
            } else {
                alert("HatalÄ± Åžifre!");
            }
        },
        logout: function() { location.reload(); },

        // --- LÄ°STE & ARAMA ---
        toggleList: function(type) {
            var listId = type === 'item' ? 'itemList' : 'machineList';
            var list = document.getElementById(listId);
            
            // DiÄŸer tÃ¼m listeleri kapat
            document.querySelectorAll('.results-list').forEach(el => {
                if(el.id !== listId) el.style.display = 'none';
            });

            if(list.style.display === "block") list.style.display = "none";
            else this.showList(type);
        },

        showList: function(type) {
            var inputId = type === 'item' ? 'searchBox' : 'machineBox';
            var listId = type === 'item' ? 'itemList' : 'machineList';
            var val = document.getElementById(inputId).value.toLocaleLowerCase('tr');
            var list = document.getElementById(listId);
            list.innerHTML = "";
            
            var source = type === 'item' ? this.dbItems : this.dbMachines;
            
            var filtered = source.filter(function(i) {
                if(type === 'item') {
                    return i.name.toLocaleLowerCase('tr').includes(val) || i.code.toLocaleLowerCase('tr').includes(val);
                } else {
                    return i.name.toLocaleLowerCase('tr').includes(val);
                }
            });

            if(filtered.length === 0) list.innerHTML = "<div style='padding:10px; color:#999; font-style:italic;'>BulunamadÄ±...</div>";

            filtered.forEach(function(item) {
                var div = document.createElement("div");
                div.className = "res-item";
                
                if(type === 'item') {
                    div.innerHTML = "<strong>" + item.code + "</strong> - " + item.name;
                    div.onmousedown = function() { app.selectItem(item); };
                } else {
                    div.innerHTML = "<strong>" + item.name + "</strong> (" + app.fmt(item.price) + ")";
                    div.onmousedown = function() { app.addMachineCost(item); };
                }
                list.appendChild(div);
            });
            list.style.display = "block";
        },

        filterList: function(type) { this.showList(type); },

        // --- SEÃ‡Ä°M Ä°ÅžLEMLERÄ° ---
        selectItem: function(item) {
            this.selItem = item;
            document.getElementById("searchBox").value = item.code + " - " + item.name;
            document.getElementById("itemList").style.display = "none";
            
            document.getElementById("unitDisplay").innerText = item.unit;
            document.getElementById("priceDisplay").value = this.fmt(item.price);
            
            // Otomatik Analiz KontrolÃ¼
            if(item.a) {
                document.getElementById("analysisInfo").style.display = "block";
                this.fillAutoAnalysis(item.a);
            } else {
                document.getElementById("analysisInfo").style.display = "none";
            }

            this.calcRevenue();
        },

        addMachineCost: function(item) {
            document.getElementById("machineBox").value = "";
            document.getElementById("machineList").style.display = "none";
            this.addCostRow(item.name + " (Kira)", 1, item.price);
        },
        
        // --- OTO ANALÄ°Z DOLDURMA ---
        fillAutoAnalysis: function(a) {
            document.getElementById("costContainer").innerHTML = "";
            var rate = parseFloat(document.getElementById("euroRate").value) || 107.31;
            var diesel = parseFloat(document.getElementById("dieselPrice").value) || 29.01;
            
            // Birim baÅŸÄ±na maliyet (DZD)
            var unitFuel = (a.f * diesel) / a.prod;
            var unitFixed = ((a.m + a.l) * rate) / a.prod;
            var unitMat = (a.mat * rate);

            this.addCostRow("YakÄ±t (Analiz)", 1, unitFuel);
            this.addCostRow("Makine+Ä°ÅŸÃ§i (Analiz)", 1, unitFixed);
            if(a.mat > 0) this.addCostRow("Malzeme (Analiz)", 1, unitMat);
        },

        // --- HESAPLAMALAR ---
        calcRevenue: function() {
            var q = parseFloat(document.getElementById("qtyInput").value) || 0;
            // FiyatÄ± string'den sayÄ±ya Ã§evir (FormatlÄ± olabilir)
            var pVal = this.selItem ? this.selItem.price : 0;
            
            this.totalRev = q * pVal;
            document.getElementById("revenueTotal").innerText = this.fmt(this.totalRev) + " DZD";
            
            // EÄŸer oto analiz varsa miktarlarÄ± gÃ¼ncelle
            this.updateAutoQuantities(q);
            this.updateSummary();
        },
        
        updateAutoQuantities: function(q) {
            var rows = document.querySelectorAll(".cost-row");
            rows.forEach(row => {
                var name = row.querySelector(".c-name").value;
                if(name.includes("(Analiz)")) {
                    row.querySelector(".q-box").value = q;
                }
            });
            this.calcCostTotal();
        },
        
        recalc: function() {
            if(this.selItem) this.selectItem(this.selItem);
        },

        // --- MALÄ°YET YÃ–NETÄ°MÄ° ---
        addCostRow: function(name="", qty="", price="") {
            var container = document.getElementById("costContainer");
            var div = document.createElement("div");
            div.className = "cost-row";
            
            // EÄŸer manuel ekleniyorsa qty 1 deÄŸilse ana miktar olsun (opsiyonel)
            var displayQty = qty;
            
            div.innerHTML = `
                <input type="text" class="c-name" value="${name}" placeholder="Gider AdÄ±">
                <input type="number" class="c-val q-box" value="${displayQty}" placeholder="Miktar" onkeyup="app.calcCostTotal()">
                <input type="number" class="c-val p-box" value="${price}" placeholder="B.Fiyat" onkeyup="app.calcCostTotal()">
                <button class="cost-del" onclick="app.delRow(this)">âœ•</button>
            `;
            container.appendChild(div);
            this.calcCostTotal();
        },

        delRow: function(btn) {
            btn.parentElement.remove();
            this.calcCostTotal();
        },

        calcCostTotal: function() {
            var total = 0;
            var rows = document.querySelectorAll(".cost-row");
            
            rows.forEach(function(row) {
                var q = parseFloat(row.querySelector(".q-box").value) || 0;
                var p = parseFloat(row.querySelector(".p-box").value) || 0;
                total += (q * p);
            });

            this.totalCost = total;
            this.updateSummary();
        },

        updateSummary: function() {
            var profit = this.totalRev - this.totalCost;
            
            document.getElementById("sumRev").innerText = this.fmt(this.totalRev);
            document.getElementById("sumCost").innerText = this.fmt(this.totalCost);
            
            var pEl = document.getElementById("sumProfit");
            pEl.innerText = this.fmt(profit);
            
            if(profit >= 0) {
                pEl.className = "f-profit profit-pos";
                pEl.innerText = "+ " + pEl.innerText;
            } else {
                pEl.className = "f-profit profit-neg";
            }
        },

        fmt: function(n) {
            return n.toLocaleString('tr-TR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        },

        quote: function() {
            var q = [
                "Zor yollar, genellikle gÃ¼zel yerlere Ã§Ä±kar.",
                "Kalite bir eylem deÄŸil, bir alÄ±ÅŸkanlÄ±ktÄ±r.",
                "Ä°ÅŸleyen demir Ä±ÅŸÄ±ldar.",
                "Planlama yoksa, baÅŸarÄ±sÄ±zlÄ±k planlanmÄ±ÅŸtÄ±r.",
                "MÃ¼hendislik, hayal gÃ¼cÃ¼nÃ¼n maddeye dÃ¶nÃ¼ÅŸmesidir."
            ];
            var r = q[Math.floor(Math.random() * q.length)];
            document.getElementById("dailyQuote").innerText = '"' + r + '"';
        }
    };

    // TÄ±klama ile listeyi kapat
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.search-container')) {
            document.querySelectorAll('.results-list').forEach(el => el.style.display = 'none');
        }
    });

</script>

</body>
</html>
