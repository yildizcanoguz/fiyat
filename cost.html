<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROJE YÖNETİM (FULL)</title>
    <style>
        /* --- MODERN VE CİDDİ TASARIM --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; padding: 0; background-color: #f0f2f5; color: #333; 
            height: 100vh; display: flex; flex-direction: column;
        }

        /* GİRİŞ EKRANI */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #f0f2f5 0%, #dbe2e8 100%);
            z-index: 99999; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .login-box {
            background: white; padding: 40px 30px; border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1); width: 85%; max-width: 350px;
            text-align: center; border: 1px solid #fff;
        }
        .login-input {
            width: 100%; padding: 15px; margin: 20px 0; border: 2px solid #e1e4e8; 
            border-radius: 12px; font-size: 24px; text-align: center; letter-spacing: 5px; 
            background: #f9fbfd; transition: all 0.3s;
        }
        .login-input:focus { border-color: #007aff; background: #fff; }
        .login-btn {
            width: 100%; padding: 15px; background: #2c3e50; color: white;
            border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer;
            box-shadow: 0 5px 15px rgba(44, 62, 80, 0.3);
        }

        /* ANA UYGULAMA */
        #appContainer {
            display: none; width: 100%; max-width: 800px; margin: 0 auto; height: 100%; 
            overflow-y: auto; padding: 15px; padding-bottom: 150px;
        }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .app-title { font-size: 20px; font-weight: 900; color: #2c3e50; letter-spacing: -0.5px; }
        .logout-btn { background: #ff3b30; color: white; border: none; padding: 8px 15px; border-radius: 8px; font-size: 11px; font-weight: 700; cursor: pointer; }

        /* BÖLÜM KUTULARI */
        .section-card {
            background: white; border-radius: 16px; padding: 20px; margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid #e1e4e8;
        }
        .section-title { font-size: 14px; font-weight: 800; color: #8e8e93; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid #f0f0f0; padding-bottom: 10px; }

        /* DROPBOX MENÜ */
        .search-container { position: relative; margin-bottom: 15px; }
        .search-input { width: 100%; padding: 16px; border: 2px solid #007aff; border-radius: 12px; font-size: 15px; font-weight: 600; outline: none; background: #fdfdfd; }
        
        .results-list {
            display: none; position: absolute; top: 110%; left: 0; right: 0;
            background: white; border-radius: 12px; max-height: 350px; overflow-y: auto;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2); border: 1px solid #e1e4e8; z-index: 1000;
        }
        .res-item { padding: 12px 15px; border-bottom: 1px solid #f0f0f0; cursor: pointer; font-size: 13px; color: #333; line-height: 1.4; }
        .res-item:hover { background: #f2f7ff; }
        .res-item strong { color: #007aff; display: block; font-size: 14px; margin-bottom: 2px; }

        /* HAKEDİŞ HESABI */
        .hakedis-grid { display: flex; gap: 10px; align-items: flex-end; }
        .hakedis-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-weight: bold; text-align: center; font-size: 16px; }
        .unit-badge { background: #eaf3ff; color: #007aff; padding: 12px; border-radius: 8px; font-weight: bold; font-size: 14px; text-align: center; min-width: 60px; }
        .hakedis-total { 
            margin-top: 15px; background: #007aff; color: white; padding: 15px; border-radius: 10px; 
            text-align: right; font-size: 20px; font-weight: 900; 
        }

        /* MALİYET KUTUCUKLARI */
        .cost-row { display: flex; gap: 5px; margin-bottom: 10px; align-items: center; background: #f9f9f9; padding: 5px; border-radius: 8px; }
        .cost-name { flex: 2; padding: 10px; border: 1px solid #e1e4e8; border-radius: 8px; font-size: 13px; }
        .cost-val { flex: 1; padding: 10px; border: 1px solid #e1e4e8; border-radius: 8px; font-size: 13px; text-align: center; }
        .cost-del { width: 30px; height: 30px; background: #ffebec; color: #ff3b30; border: none; border-radius: 50%; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        
        .add-btn { 
            width: 100%; padding: 12px; background: #fff; color: #e67e22; border: 2px dashed #e67e22; 
            border-radius: 10px; font-weight: 800; cursor: pointer; margin-top: 10px;
        }
        .add-btn:active { background: #fff8f0; }

        /* ALT TOPLAM ÇUBUĞU */
        .footer-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; background: white;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1); padding: 15px; z-index: 999;
            display: flex; justify-content: space-between; align-items: center;
            border-top: 1px solid #eee;
        }
        .footer-item { text-align: center; flex: 1; }
        .f-label { display: block; font-size: 10px; color: #8e8e93; font-weight: 700; text-transform: uppercase; }
        .f-val { font-size: 15px; font-weight: 800; color: #333; }
        .f-profit { font-size: 20px; font-weight: 900; }
        .profit-pos { color: #27ae60; }
        .profit-neg { color: #ff3b30; }

        /* GÜNÜN SÖZÜ */
        .quote-box { margin-top: 20px; text-align: center; font-style: italic; color: #888; font-size: 12px; padding-bottom: 20px; }

    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-box">
        <h3 style="color:#2c3e50; margin-bottom:20px;">PROJE YÖNETİM</h3>
        <input type="password" id="passInput" class="login-input" placeholder="****" inputmode="numeric">
        <button class="login-btn" onclick="app.login()">GİRİŞ YAP</button>
        <p id="loginError" style="color:red; display:none; margin-top:10px; font-weight:bold; font-size:13px;">Hatalı Şifre!</p>
    </div>
</div>

<div id="appContainer">
    <div class="header">
        <div class="app-title">HAKEDİŞ & MALİYET</div>
        <button class="logout-btn" onclick="app.logout()">ÇIKIŞ</button>
    </div>

    <div class="section-card" style="border-left: 5px solid #007aff;">
        <div class="section-title">1. HAKEDİŞ HESABI (GELİR)</div>
        
        <label style="font-size:12px; font-weight:bold; color:#555; display:block; margin-bottom:5px;">İş Kalemi Seçiniz:</label>
        
        <div class="search-container">
            <input type="text" id="searchBox" class="search-input" placeholder="Listeden seçin (Tıklayın)..." onkeyup="app.filterList()" onclick="app.toggleList()" autocomplete="off">
            <div id="resList" class="results-list"></div>
        </div>

        <div class="hakedis-grid">
            <div style="flex:0 0 70px;">
                <label style="font-size:11px; font-weight:bold; color:#888;">Birim</label>
                <div id="unitDisplay" class="unit-badge">-</div>
            </div>
            <div style="flex:1;">
                <label style="font-size:11px; font-weight:bold; color:#888;">Birim Fiyat (DZD)</label>
                <input type="text" id="priceDisplay" class="hakedis-input" readonly placeholder="0.00" style="background:#f9f9f9; color:#666;">
            </div>
            <div style="flex:1;">
                <label style="font-size:11px; font-weight:bold; color:#888;">Yapılan Miktar</label>
                <input type="number" id="qtyInput" class="hakedis-input" placeholder="0" oninput="app.calcRevenue()">
            </div>
        </div>

        <div id="revenueTotal" class="hakedis-total">0.00 DZD</div>
    </div>

    <div class="section-card" style="border-left: 5px solid #e67e22;">
        <div class="section-title">2. GERÇEKLEŞEN MALİYET (GİDER)</div>
        
        <div id="costContainer">
            </div>

        <button class="add-btn" onclick="app.addCostRow()">+ YENİ GİDER EKLE</button>
    </div>

    <div class="quote-box" id="dailyQuote">...</div>

</div>

<div class="footer-bar" id="footerBar" style="display:none;">
    <div class="footer-item">
        <span class="f-label">GELİR</span>
        <span class="f-val" id="sumRev" style="color:#007aff;">0</span>
    </div>
    <div class="footer-item">
        <span class="f-label">GİDER</span>
        <span class="f-val" id="sumCost" style="color:#e67e22;">0</span>
    </div>
    <div class="footer-item">
        <span class="f-label">KÂR / ZARAR</span>
        <span class="f-profit" id="sumProfit">0</span>
    </div>
</div>

<script>
    var app = {
        PASS: "1907",
        selItem: null,
        totalRev: 0,
        totalCost: 0,

        // --- TAM VERİTABANI (268 Kalem) ---
        db: [
            { code: "A.1", name: "Installation et repliement / Şantiye Kurulumu", unit: "Ft", price: 1041277260.86 },
            { code: "A.2.1", name: "Laboratoire de chantier / Şantiye Laboratuvarı", unit: "Ft", price: 41644039.15 },
            { code: "A.2.2", name: "Contrôle externe / Dış Kontrol", unit: "Ft", price: 33983960.76 },
            { code: "A.3.1", name: "Études d'exécution / Uygulama Projeleri", unit: "Ft", price: 212842500.00 },
            { code: "A.3.2", name: "Contrôle externe des études / Proje Kontrolü", unit: "Ft", price: 45999996.83 },
            { code: "A.3.3", name: "Dossier de récolement / As-built", unit: "Ft", price: 33568500.00 },
            { code: "A.3.4", name: "Étude des méthodes / Metodoloji", unit: "Ft", price: 7500069.87 },
            { code: "A.3.5", name: "Reconnaissances géotechniques / Jeoteknik", unit: "Ft", price: 40209555.68 },
            { code: "A.4.1", name: "Sécurité passive", unit: "Ft", price: 200000000.00 },
            { code: "A.4.2", name: "Sécurité active", unit: "Ft", price: 400000000.00 },
            { code: "A.5", name: "Panneau identification", unit: "U", price: 1775000.00 },
            { code: "B.1.1", name: "Débroussaillage / Çalı Temizliği", unit: "Ha", price: 619820.41 },
            { code: "B.1.2", name: "Abattage arbres", unit: "U", price: 1600.00 },
            { code: "B.1.3", name: "Dépose ouvrages", unit: "Tonne", price: 944.25 },
            { code: "B.2.1", name: "Démolition divers", unit: "m3", price: 1335.05 },
            { code: "B.2.2", name: "Démolition béton", unit: "m3", price: 1620.22 },
            { code: "B.2.3", name: "Démolition chaussée", unit: "m3", price: 207.70 },
            { code: "B.3.1", name: "Rabotage <10cm", unit: "m2", price: 88.85 },
            { code: "B.3.2", name: "Rabotage 10-20cm", unit: "m2", price: 98.62 },
            { code: "B.4", name: "Scarification", unit: "m2", price: 28.16 },
            { code: "C.1.1", name: "Décapage / Sıyırma", unit: "m3", price: 128.62 },
            { code: "C.1.2", name: "Reprise stock", unit: "m3", price: 179.08 },
            { code: "C.2.2", name: "Purges", unit: "m3", price: 2200.00 },
            { code: "C.3.1", name: "Déblai meuble / Yumuşak Kazı", unit: "m3", price: 257.24 },
            { code: "C.3.2", name: "Déblai semi-dur / Küskülük Kazı", unit: "m3", price: 386.32 },
            { code: "C.3.3", name: "Déblai rocheux / Kaya Kazı", unit: "m3", price: 1308.96 },
            { code: "C.4.1", name: "Déblai meuble dépôt", unit: "m3", price: 148.16 },
            { code: "C.4.2", name: "Déblai semi-dur dépôt", unit: "m3", price: 307.70 },
            { code: "C.4.3", name: "Déblai rocheux dépôt", unit: "m3", price: 893.10 },
            { code: "C.5.1", name: "Remblai emprunt / Ariyet", unit: "m3", price: 555.63 },
            { code: "C.6.1", name: "Assise drainante", unit: "m3", price: 1166.55 },
            { code: "C.7.1", name: "Géotextile renfort", unit: "m2", price: 290.80 },
            { code: "C.7.2", name: "Géotextile anti-contam", unit: "m2", price: 258.27 },
            { code: "C.7.3", name: "Géogrille", unit: "m2", price: 418.04 },
            { code: "C.8.1", name: "Arrondi crête", unit: "ml", price: 317.01 },
            { code: "C.9.1", name: "Couche forme (CDF)", unit: "m3", price: 1346.55 },
            { code: "D.1.1", name: "Fossé A", unit: "ml", price: 495.86 },
            { code: "D.1.2", name: "Fossé B", unit: "ml", price: 594.94 },
            { code: "D.1.3", name: "Fossé C", unit: "ml", price: 897.18 },
            { code: "D.1.4", name: "Végétalisation", unit: "ml", price: 874.94 },
            { code: "D.2.1", name: "Bétonnage A", unit: "ml", price: 4448.37 },
            { code: "D.2.2", name: "Bétonnage B", unit: "ml", price: 5662.50 },
            { code: "D.2.3", name: "Bétonnage C", unit: "ml", price: 6316.17 },
            { code: "D.3.1", name: "Cunette végétalisée", unit: "ml", price: 3402.40 },
            { code: "D.3.2", name: "Cunette béton", unit: "ml", price: 4304.81 },
            { code: "D.3.3", name: "Cunette symétrique", unit: "ml", price: 4829.18 },
            { code: "D.4.1", name: "Descente A", unit: "ml", price: 2912.86 },
            { code: "D.4.2", name: "Descente B", unit: "ml", price: 3357.57 },
            { code: "D.4.3", name: "Descente C", unit: "ml", price: 3634.81 },
            { code: "D.4.4", name: "Descente D", unit: "ml", price: 4119.98 },
            { code: "D.5.1", name: "Descente tuile A", unit: "ml", price: 2200.00 },
            { code: "D.5.2", name: "Descente tuile B", unit: "ml", price: 3520.00 },
            { code: "D.5.3", name: "Descente tuile C", unit: "ml", price: 4200.00 },
            { code: "D.6.1", name: "Caniveau U 30x40", unit: "ml", price: 4800.00 },
            { code: "D.6.2", name: "Caniveau U 40x50", unit: "ml", price: 5800.00 },
            { code: "D.6.3", name: "Caniveau U 45x55", unit: "ml", price: 6300.00 },
            { code: "D.7.1", name: "Caniveau fente 300", unit: "ml", price: 22200.00 },
            { code: "D.7.2", name: "Caniveau fente 400", unit: "ml", price: 26600.00 },
            { code: "D.7.3", name: "Caniveau fente 500", unit: "ml", price: 29300.00 },
            { code: "D.7.4", name: "Renforcement", unit: "ml", price: 11191.83 },
            { code: "D.8.1", name: "Demi-buse 300", unit: "ml", price: 4400.00 },
            { code: "D.8.2", name: "Demi-buse 400", unit: "ml", price: 5700.00 },
            { code: "D.8.3", name: "Demi-buse 500", unit: "ml", price: 7800.00 },
            { code: "D.9.1", name: "Déblai tranchée <2m", unit: "m3", price: 217.93 },
            { code: "D.9.2", name: "Déblai tranchée 2-4m", unit: "m3", price: 277.24 },
            { code: "D.9.3", name: "Déblai tranchée 4-6m", unit: "m3", price: 326.55 },
            { code: "D.9.4", name: "PV Roche tranchée", unit: "m3", price: 1500.00 },
            { code: "D.10.1", name: "Lit sable", unit: "m3", price: 1455.51 },
            { code: "D.10.2", name: "Lit béton", unit: "m3", price: 5962.17 },
            { code: "D.11.1", name: "Enrobage grave", unit: "m3", price: 1437.35 },
            { code: "D.11.2", name: "Enrobage béton", unit: "m3", price: 5593.89 },
            { code: "D.11.3", name: "Enrobage drainant", unit: "m3", price: 1739.65 },
            { code: "D.12.1", name: "Tuyau 400mm", unit: "ml", price: 7769.31 },
            { code: "D.12.2", name: "Tuyau 600mm", unit: "ml", price: 9369.31 },
            { code: "D.13.1", name: "Buse 800mm", unit: "ml", price: 15498.73 },
            { code: "D.13.2", name: "Buse 1000mm", unit: "ml", price: 21631.72 },
            { code: "D.13.3", name: "Buse 1200mm", unit: "ml", price: 36375.97 },
            { code: "D.13.4", name: "Buse 1500mm", unit: "ml", price: 50775.97 },
            { code: "D.14.1", name: "Collecteur 150mm", unit: "ml", price: 2700.00 },
            { code: "D.17.1", name: "Tuyau PEHD 75mm", unit: "ml", price: 1236.00 },
            { code: "D.17.2", name: "Tuyau PEHD 90mm", unit: "ml", price: 1500.00 },
            { code: "D.18.1", name: "Chambre K1C", unit: "U", price: 112000.00 },
            { code: "D.18.2", name: "Chambre K2C", unit: "U", price: 125000.00 },
            { code: "D.19.1", name: "Regard 1000mm", unit: "U", price: 120000.00 },
            { code: "D.20.1", name: "Puisard", unit: "U", price: 150000.00 },
            { code: "D.20.2", name: "Puisard 1300", unit: "U", price: 174000.00 },
            { code: "D.20.3", name: "Puisard 1500", unit: "U", price: 188000.00 },
            { code: "D.20.4", name: "Puisard 1800", unit: "U", price: 215000.00 },
            { code: "D.20.5", name: "Puisard 2000", unit: "U", price: 220000.00 },
            { code: "D.20.6", name: "Puisard 2500", unit: "U", price: 260000.00 },
            { code: "D.21.1", name: "Grille 700x700", unit: "U", price: 32000.00 },
            { code: "D.21.2", name: "Grille 250x400", unit: "U", price: 26826.09 },
            { code: "D.21.3", name: "Caillebotis 1x1m", unit: "U", price: 5400.00 },
            { code: "D.21.4", name: "Caillebotis 1x2m", unit: "U", price: 9200.00 },
            { code: "D.22.1", name: "Tête buse 600", unit: "U", price: 60925.34 },
            { code: "D.22.2", name: "Tête buse 800", unit: "U", price: 68921.05 },
            { code: "D.22.3", name: "Tête buse 1000", unit: "U", price: 76992.73 },
            { code: "D.22.4", name: "Tête buse 1200", unit: "U", price: 90558.06 },
            { code: "D.22.5", name: "Tête buse 1500", unit: "U", price: 125386.97 },
            { code: "D.23.1", name: "Bourrelet", unit: "ml", price: 3000.00 },
            { code: "D.24.1", name: "Enrochement A", unit: "m3", price: 1879.30 },
            { code: "D.24.2", name: "Enrochement B", unit: "m3", price: 1879.30 },
            { code: "D.24.3", name: "Enrochement C", unit: "m3", price: 1879.30 },
            { code: "D.25.1", name: "Enrochement lié", unit: "m3", price: 2042.98 },
            { code: "D.26.1", name: "Barbacane", unit: "ml", price: 1700.00 },
            { code: "D.27.1", name: "Béton propreté", unit: "m3", price: 178.16 },
            { code: "D.27.2", name: "Béton ouvrages", unit: "m3", price: 9553.28 },
            { code: "D.27.3", name: "Coffrage", unit: "m2", price: 920.22 },
            { code: "D.27.4", name: "Ferraillage", unit: "kg", price: 65.08 },
            { code: "E.1.1", name: "Grave GNT / PMT", unit: "m3", price: 1922.64 },
            { code: "E.2.1", name: "Grave Bitume GB", unit: "Tonne", price: 3390.32 },
            { code: "E.2.2", name: "Enrobés EME 2", unit: "Tonne", price: 4782.15 },
            { code: "E.3.1", name: "Couche BB / Aşınma", unit: "Tonne", price: 4337.90 },
            { code: "E.4.1", name: "Imprégnation", unit: "m2", price: 95.00 },
            { code: "E.5.1", name: "Bicouche", unit: "m2", price: 540.00 },
            { code: "E.6.1", name: "Bordure A2", unit: "ml", price: 2000.00 },
            { code: "F.1.1", name: "Hachures", unit: "m2", price: 680.00 },
            { code: "F.1.2", name: "Bande 100mm", unit: "ml", price: 70.00 },
            { code: "F.1.3", name: "Bande 150mm", unit: "ml", price: 145.00 },
            { code: "F.1.4", name: "Bande 225mm", unit: "ml", price: 200.00 },
            { code: "F.1.5", name: "Bande 375mm", unit: "ml", price: 340.00 },
            { code: "F.1.6", name: "Bande 500mm", unit: "ml", price: 420.00 },
            { code: "F.1.7", name: "Flèche rabattement", unit: "U", price: 600.00 },
            { code: "F.1.8", name: "Flèche simple", unit: "U", price: 800.00 },
            { code: "F.1.9", name: "Flèche double", unit: "U", price: 820.00 },
            { code: "F.2.1", name: "Bande préfa.", unit: "ml", price: 800.00 },
            { code: "G.1.1", name: "Panneau A/AB", unit: "U", price: 52000.00 },
            { code: "G.5.1", name: "Poteaux < 50", unit: "ml", price: 9776.59 },
            { code: "G.7.1", name: "Réflecteur", unit: "U", price: 1670.00 },
            { code: "H.1.1.1", name: "Glissière GS4", unit: "ml", price: 1238.45 },
            { code: "H.2.1.1", name: "Barrière GBA", unit: "ml", price: 3932.51 },
            { code: "I.1.1", name: "Fouilles murs", unit: "m3", price: 178.16 },
            { code: "I.1.3", name: "Béton propreté", unit: "m3", price: 5919.19 },
            { code: "I.1.6", name: "Béton fondations", unit: "m3", price: 8973.98 },
            { code: "I.3.1", name: "Panneaux antibruit", unit: "m2", price: 88750.00 },
            { code: "I.5.3", name: "Enrochement", unit: "m3", price: 2205.85 },
            { code: "I.6.1", name: "Séparateur hydro.", unit: "U", price: 4400000.00 },
            { code: "I.8.1", name: "Clôtures", unit: "ml", price: 5934.02 },
            { code: "I.9.1", name: "Plantation arbres", unit: "m2", price: 1545.17 },
            { code: "J.1.1", name: "Mur gabions", unit: "m3", price: 3034.57 },
            { code: "J.2.1", name: "Béton projeté", unit: "m3", price: 13478.48 },
            { code: "J.2.3.1", name: "Clous 12m", unit: "U", price: 19236.87 },
            { code: "J.6.1", name: "Drains", unit: "ml", price: 4700.00 },
            { code: "J.8.1", name: "Ancrages 32mm", unit: "ml", price: 470.10 },
            { code: "J.11", name: "Atalus", unit: "m2", price: 18500.00 },
            { code: "J.12.1", name: "Terre Armée", unit: "m2", price: 13600.00 },
            { code: "K.1.1", name: "Caméra", unit: "U", price: 412003.51 },
            { code: "NP.48", name: "Déplacement cimetière", unit: "U", price: 22275.00 },
            { code: "OUA.B.1.1", name: "Déblais fouilles / Temel Kazısı (OA)", unit: "m3", price: 178.16 },
            { code: "OUA.B.2.1", name: "Pieux 1200 mm / Fore Kazık", unit: "ml", price: 5404.19 },
            { code: "OUA.B.5.2.1", name: "Béton C40 Caisson", unit: "m3", price: 21343.02 },
            { code: "OUA.B.5.2.6", name: "Béton C35 Piles", unit: "m3", price: 12538.45 },
            { code: "OUA.B.6.1.1", name: "Acier HA / Demir", unit: "Tonne", price: 67033.93 },
            { code: "OUA.B.6.2", name: "Précontrainte", unit: "Tonne", price: 55688.54 },
            { code: "OUA.B.7.1.1", name: "Appareil 2100", unit: "U", price: 260001.71 },
            { code: "OUA.B.7.5.1", name: "Joint 240mm", unit: "ml", price: 9389.70 },
            { code: "OUA.C.1", name: "Palplanches", unit: "m2", price: 25000.00 },
            { code: "OUA.NP.06", name: "Isolateur sismique", unit: "U", price: 134282.61 },
            { code: "OUA.NP.09a", name: "Tirants 45T", unit: "ml", price: 4260.00 },
            { code: "OUA.NP.08.41", name: "Drain perforé", unit: "ml", price: 2700.00 },
            { code: "TUN.E.1.1", name: "Fondation GNT", unit: "m3", price: 1862.41 },
            { code: "TUN.E.1.3", name: "Enrobé EME", unit: "Tonne", price: 4812.84 },
            { code: "TUN.C.1.2", name: "Déblais explosif", unit: "m3", price: 4883.43 },
            { code: "TUN.C.3.1", name: "Boulons 4m", unit: "U", price: 2832.82 },
            { code: "TUN.D.2.1", name: "Béton projeté", unit: "m3", price: 13046.21 },
            { code: "TUN.F.2.1", name: "Ventilateurs", unit: "U", price: 459359.84 },
            { code: "TU.E.3.1.1", name: "Panneau Tunnel", unit: "U", price: 11768.62 }
        ],

        // --- GİRİŞ ---
        login: function() {
            if(document.getElementById("passInput").value === this.PASS) {
                document.getElementById("loginOverlay").style.display = "none";
                document.getElementById("appContainer").style.display = "block";
                document.getElementById("footerBar").style.display = "flex";
                this.addCostRow(); // İlk satırı ekle
                this.quote();
            } else {
                alert("Hatalı Şifre!");
            }
        },
        logout: function() { location.reload(); },

        // --- ARAMA KUTUSU ---
        toggleList: function() {
            var list = document.getElementById("resList");
            if(list.style.display === "block") list.style.display = "none";
            else this.showList();
        },

        showList: function() {
            var val = document.getElementById("searchBox").value.toLocaleLowerCase('tr');
            var list = document.getElementById("resList");
            list.innerHTML = "";
            
            // Filtreleme (Kod veya İsim)
            var filtered = this.db.filter(function(i) {
                return i.name.toLocaleLowerCase('tr').includes(val) || i.code.toLocaleLowerCase('tr').includes(val);
            });

            if(filtered.length === 0) list.innerHTML = "<div style='padding:10px; color:#999; font-style:italic;'>Bulunamadı...</div>";

            filtered.forEach(function(item) {
                var div = document.createElement("div");
                div.className = "res-item";
                div.innerHTML = "<strong>" + item.code + "</strong> - " + item.name;
                
                // Mousedown önemli (Blur'dan önce yakalar)
                div.onmousedown = function() { app.selectItem(item); };
                list.appendChild(div);
            });
            list.style.display = "block";
        },

        filterList: function() { this.showList(); },

        selectItem: function(item) {
            this.selItem = item;
            document.getElementById("searchBox").value = item.code + " - " + item.name;
            document.getElementById("resList").style.display = "none";
            
            document.getElementById("unitDisplay").innerText = item.unit;
            document.getElementById("priceDisplay").value = item.price;
            this.calcRevenue();
        },

        // --- HESAPLAMALAR ---
        calcRevenue: function() {
            if(!this.selItem) return;
            var q = parseFloat(document.getElementById("qtyInput").value);
            if(isNaN(q)) q = 0;
            
            this.totalRev = q * this.selItem.price;
            document.getElementById("revenueTotal").innerText = this.fmt(this.totalRev) + " DZD";
            this.updateSummary();
        },

        // --- MALİYET YÖNETİMİ (DİNAMİK KUTUCUKLAR) ---
        addCostRow: function() {
            var container = document.getElementById("costContainer");
            var div = document.createElement("div");
            div.className = "cost-row";
            div.innerHTML = `
                <input type="text" class="cost-name" placeholder="Gider Adı (Örn: Mazot)">
                <input type="number" class="cost-val" placeholder="Miktar" oninput="app.calcCostTotal()">
                <input type="number" class="cost-val" placeholder="B.Fiyat" oninput="app.calcCostTotal()">
                <button class="cost-del" onclick="app.delRow(this)">✕</button>
            `;
            container.appendChild(div);
        },

        delRow: function(btn) {
            btn.parentElement.remove();
            this.calcCostTotal();
        },

        calcCostTotal: function() {
            var total = 0;
            var rows = document.querySelectorAll(".cost-row");
            
            rows.forEach(function(row) {
                var inputs = row.querySelectorAll("input");
                var qty = parseFloat(inputs[1].value);
                var price = parseFloat(inputs[2].value);
                
                if(!isNaN(qty) && !isNaN(price)) {
                    total += (qty * price);
                }
            });

            this.totalCost = total;
            this.updateSummary();
        },

        updateSummary: function() {
            var profit = this.totalRev - this.totalCost;
            
            document.getElementById("sumRev").innerText = this.fmt(this.totalRev);
            document.getElementById("sumCost").innerText = this.fmt(this.totalCost);
            
            var pEl = document.getElementById("sumProfit");
            pEl.innerText = this.fmt(profit);
            
            if(profit >= 0) {
                pEl.className = "f-profit profit-pos";
                pEl.innerText = "+ " + pEl.innerText;
            } else {
                pEl.className = "f-profit profit-neg";
            }
        },

        fmt: function(n) {
            return n.toLocaleString('tr-TR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        },

        quote: function() {
            var q = [
                "Zor yollar, genellikle güzel yerlere çıkar.",
                "Kalite bir eylem değil, bir alışkanlıktır.",
                "İşleyen demir ışıldar.",
                "Planlama yoksa, başarısızlık planlanmıştır.",
                "Mühendislik, hayal gücünün maddeye dönüşmesidir."
            ];
            var r = q[Math.floor(Math.random() * q.length)];
            document.getElementById("dailyQuote").innerText = '"' + r + '"';
        }
    };

    // Tıklama ile listeyi kapat
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.search-container')) {
            document.getElementById("resList").style.display = "none";
        }
    });

</script>

</body>
</html>
