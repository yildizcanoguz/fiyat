<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MASTER DQE PRO</title>
    <style>
        /* --- G√ñZ ALICI MODERN TASARIM --- */
        :root {
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #333;
            --primary: #3498db;
            --secondary: #e67e22;
            --accent: #9b59b6;
            --border: #e1e4e8;
            --shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        /* DARK MODE DEƒûƒ∞≈ûKENLERƒ∞ */
        [data-theme="dark"] {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #e94560;
            --text-color: #f1f1f1; /* Metin rengi d√ºzeltme */
            --primary: #0f3460;
            --secondary: #e94560;
            --border: #2a2a40;
            --shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; transition: background 0.3s, color 0.3s; }
        
        body { 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; padding: 0; background-color: var(--bg-color); color: var(--text-color);
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        /* √úST BAR & TEMA BUTONU */
        .top-bar {
            padding: 15px 20px; background: var(--card-bg); display: flex; justify-content: space-between; align-items: center;
            box-shadow: var(--shadow); z-index: 1000;
        }
        .app-logo { font-size: 18px; font-weight: 900; background: linear-gradient(45deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .theme-toggle {
            cursor: pointer; font-size: 20px; padding: 5px; border-radius: 50%;
            background: var(--bg-color); width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;
        }

        /* Gƒ∞Rƒ∞≈û EKRANI */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); z-index: 99999; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .login-box {
            background: var(--card-bg); padding: 40px 30px; border-radius: 24px;
            box-shadow: var(--shadow); width: 85%; max-width: 350px; text-align: center;
        }
        .login-input {
            width: 100%; padding: 15px; margin: 20px 0; border: 2px solid var(--border); 
            border-radius: 12px; font-size: 24px; text-align: center; letter-spacing: 5px; 
            background: var(--bg-color); color: var(--text-color);
        }
        .login-input:focus { border-color: #3498db; }
        .login-btn {
            width: 100%; padding: 15px; background: linear-gradient(135deg, #3498db, #2980b9); color: white;
            border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer;
        }

        /* ANA ƒ∞√áERƒ∞K */
        #appContainer {
            display: none; width: 100%; max-width: 800px; margin: 0 auto; height: 100%; 
            overflow-y: auto; padding: 20px; padding-bottom: 120px;
        }

        /* PARAMETRE KARTLARI */
        .params-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .param-card {
            background: var(--card-bg); padding: 15px; border-radius: 16px; box-shadow: var(--shadow);
            text-align: center; border: 1px solid var(--border);
        }
        .param-label { font-size: 10px; font-weight: 800; opacity: 0.7; display: block; margin-bottom: 5px; text-transform: uppercase;}
        .param-input { 
            width: 100%; border: none; background: transparent; text-align: center; 
            font-size: 18px; font-weight: 800; color: var(--text-color); border-bottom: 2px solid var(--border);
        }

        /* ANA KARTLAR */
        .main-card {
            background: var(--card-bg); border-radius: 20px; padding: 20px; margin-bottom: 25px;
            box-shadow: var(--shadow); border: 1px solid var(--border); position: relative; overflow: visible;
        }
        .card-badge {
            position: absolute; top: -10px; left: 20px; background: var(--primary); color: white;
            padding: 5px 15px; border-radius: 20px; font-size: 11px; font-weight: 800; letter-spacing: 1px;
        }
        .card-badge.orange { background: var(--secondary); }

        /* ARAMA & LISTE */
        .search-box {
            position: relative; background: var(--bg-color); border-radius: 12px; 
            display: flex; align-items: center; margin-top: 15px; border: 1px solid var(--border);
        }
        .search-inp {
            flex: 1; padding: 15px; border: none; background: transparent; font-size: 14px; font-weight: 600; color: var(--text-color);
        }
        .list-trigger { padding: 15px; font-size: 12px; font-weight: 900; color: var(--primary); cursor: pointer; }

        .dropdown-list {
            display: none; position: absolute; top: 110%; left: 0; right: 0;
            background: var(--card-bg); border-radius: 12px; max-height: 350px; overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2); border: 1px solid var(--border); z-index: 999;
        }
        .list-item { 
            padding: 15px; border-bottom: 1px solid var(--border); cursor: pointer; font-size: 13px; 
            display: flex; justify-content: space-between; align-items: center;
        }
        .list-item:hover { background: var(--bg-color); }
        .list-item strong { color: var(--primary); }

        /* HESAPLAMA ALANLARI */
        .calc-row { display: flex; align-items: center; margin-top: 15px; gap: 10px; }
        .calc-box { 
            flex: 1; background: var(--bg-color); padding: 10px; border-radius: 10px; 
            text-align: right; font-weight: 800; font-size: 16px; border: 1px solid var(--border);
        }
        .total-res { 
            margin-top: 15px; text-align: right; font-size: 24px; font-weight: 900; 
            color: var(--primary); letter-spacing: -1px; 
        }

        /* Gƒ∞DER Lƒ∞STESƒ∞ */
        .cost-item { 
            background: var(--bg-color); padding: 10px; border-radius: 10px; margin-bottom: 8px;
            display: flex; align-items: center; gap: 8px;
        }
        .cost-inp { 
            background: transparent; border: none; color: var(--text-color); font-size: 13px; font-weight: 600; width: 100%;
        }
        .del-btn { color: #ff4757; cursor: pointer; font-weight: 900; padding: 5px; }

        /* ALT √áUBUK */
        .bottom-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; 
            background: var(--card-bg); padding: 15px 20px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1); display: flex; justify-content: space-between;
            border-top: 1px solid var(--border); z-index: 999;
        }
        .bot-item span { display: block; font-size: 10px; opacity: 0.6; font-weight: 700; }
        .bot-val { font-size: 16px; font-weight: 800; }
        .bot-profit { font-size: 22px; font-weight: 900; }
        .plus { color: #2ecc71; } .minus { color: #ff4757; }

        /* S√ñZ */
        .quote { text-align: center; font-size: 12px; font-style: italic; opacity: 0.6; margin-top: 20px; cursor: pointer; }

    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-box">
        <h2 style="margin-bottom:20px; color:var(--primary);">MASTER DQE</h2>
        <input type="password" id="passInput" class="login-input" placeholder="****" inputmode="numeric">
        <button class="login-btn" onclick="app.login()">Gƒ∞Rƒ∞≈û / ENTRER</button>
    </div>
</div>

<div id="appContainer">
    
    <div class="top-bar">
        <div class="app-logo">DQE PRO üèóÔ∏è</div>
        <div class="theme-toggle" onclick="app.toggleTheme()">üåô</div>
    </div>

    <div style="height:20px;"></div>

    <div class="params-grid">
        <div class="param-card">
            <span class="param-label">MAZOT (DZD)</span>
            <input type="number" id="dieselPrice" class="param-input" value="29.01" onkeyup="app.recalc()">
        </div>
        <div class="param-card">
            <span class="param-label">EURO KURU</span>
            <input type="number" id="euroRate" class="param-input" value="107.31" onkeyup="app.recalc()">
        </div>
    </div>

    <div class="main-card">
        <div class="card-badge">HAKEDƒ∞≈û (GELƒ∞R)</div>
        
        <div class="search-box">
            <input type="text" id="searchBox" class="search-inp" placeholder="ƒ∞≈ü Kalemi Ara..." onkeyup="app.filterList('item')" onclick="app.toggleList('item')" autocomplete="off">
            <div class="list-trigger" onclick="app.toggleList('item')">‚ñº Lƒ∞STE</div>
            <div id="itemList" class="dropdown-list"></div>
        </div>

        <div class="calc-row">
            <div class="calc-box" id="unitDisplay" style="text-align:center; flex:0 0 60px; font-size:12px;">Birim</div>
            <div class="calc-box" style="flex:1;">
                <input id="priceDisplay" readonly style="width:100%; border:none; background:transparent; text-align:right; font-weight:bold; color:var(--text-color);" placeholder="0.00">
            </div>
            <div class="calc-box" style="flex:1;">
                <input type="number" id="qtyInput" style="width:100%; border:none; background:transparent; text-align:right; font-weight:bold; color:var(--text-color);" placeholder="Miktar" onkeyup="app.calcRevenue()">
            </div>
        </div>

        <div id="revenueTotal" class="total-res">0.00 DZD</div>
    </div>

    <div class="main-card" style="border-color:var(--secondary);">
        <div class="card-badge orange">MALƒ∞YET (Gƒ∞DER)</div>

        <div class="search-box" style="border-color:var(--secondary); margin-bottom:15px;">
            <input type="text" id="machineBox" class="search-inp" placeholder="Makine Se√ß (Ekskavat√∂r...)" onkeyup="app.filterList('machine')" onclick="app.toggleList('machine')" autocomplete="off">
            <div class="list-trigger" style="color:var(--secondary);" onclick="app.toggleList('machine')">‚ñº MAKƒ∞NE</div>
            <div id="machineList" class="dropdown-list"></div>
        </div>

        <div id="costContainer"></div>

        <button onclick="app.addCostRow()" style="width:100%; padding:12px; background:var(--bg-color); border:2px dashed #ccc; border-radius:12px; color:var(--text-color); font-weight:bold; cursor:pointer; margin-top:10px;">+ MANUEL Gƒ∞DER EKLE</button>
    </div>

    <div class="quote" id="dailyQuote" onclick="app.newQuote()">...</div>

</div>

<div class="bottom-bar" id="footerBar" style="display:none;">
    <div class="bot-item">
        <span>GELƒ∞R</span>
        <div class="bot-val" style="color:var(--primary);" id="sumRev">0</div>
    </div>
    <div class="bot-item">
        <span>Gƒ∞DER</span>
        <div class="bot-val" style="color:var(--secondary);" id="sumCost">0</div>
    </div>
    <div class="bot-item" style="text-align:right;">
        <span>NET K√ÇR</span>
        <div class="bot-profit" id="sumProfit">0</div>
    </div>
</div>

<script>
    var app = {
        PASS: "1907",
        selItem: null,
        totalRev: 0,
        totalCost: 0,
        theme: 'light',

        // --- VERƒ∞TABANI (268 Kalem + Analiz) ---
        dbItems: [
            { code: "A.1", name: "Installation et repliement / ≈ûantiye Kurulumu", unit: "Ft", price: 1041277260.86 },
            { code: "A.2.1", name: "Laboratoire de chantier / ≈ûantiye Laboratuvarƒ±", unit: "Ft", price: 41644039.15 },
            { code: "A.2.2", name: "Contr√¥le externe / Dƒ±≈ü Kontrol", unit: "Ft", price: 33983960.76 },
            { code: "A.3.1", name: "√âtudes d'ex√©cution / Uygulama Projeleri", unit: "Ft", price: 212842500.00 },
            { code: "A.3.2", name: "Contr√¥le externe des √©tudes / Proje Kontrol√º", unit: "Ft", price: 45999996.83 },
            { code: "A.3.3", name: "Dossier de r√©colement / As-built", unit: "Ft", price: 33568500.00 },
            { code: "A.3.4", name: "√âtude des m√©thodes / Metodoloji", unit: "Ft", price: 7500069.87 },
            { code: "A.3.5", name: "Reconnaissances g√©otechniques / Jeoteknik", unit: "Ft", price: 40209555.68 },
            { code: "A.4.1", name: "S√©curit√© passive", unit: "Ft", price: 200000000.00 },
            { code: "A.4.2", name: "S√©curit√© active", unit: "Ft", price: 400000000.00 },
            { code: "A.5", name: "Panneau identification", unit: "U", price: 1775000.00 },
            { code: "B.1.1", name: "D√©broussaillage / √áalƒ± Temizliƒüi", unit: "Ha", price: 619820.41 },
            { code: "B.1.2", name: "Abattage arbres", unit: "U", price: 1600.00 },
            { code: "B.1.3", name: "D√©pose ouvrages", unit: "Tonne", price: 944.25 },
            { code: "B.2.1", name: "D√©molition divers", unit: "m3", price: 1335.05 },
            { code: "B.2.2", name: "D√©molition b√©ton", unit: "m3", price: 1620.22 },
            { code: "B.2.3", name: "D√©molition chauss√©e", unit: "m3", price: 207.70 },
            { code: "B.3.1", name: "Rabotage <10cm", unit: "m2", price: 88.85 },
            { code: "B.3.2", name: "Rabotage 10-20cm", unit: "m2", price: 98.62 },
            { code: "B.4", name: "Scarification", unit: "m2", price: 28.16 },
            { code: "C.1.1", name: "D√©capage / Sƒ±yƒ±rma", unit: "m3", price: 128.62, a:{m:300, f:150, l:100, mat:0, prod:4000} },
            { code: "C.1.2", name: "Reprise stock", unit: "m3", price: 179.08 },
            { code: "C.2.2", name: "Purges", unit: "m3", price: 2200.00 },
            { code: "C.3.1", name: "D√©blai meuble / Yumu≈üak Kazƒ±", unit: "m3", price: 257.24, a:{m:450, f:280, l:150, mat:0, prod:3600} },
            { code: "C.3.2", name: "D√©blai semi-dur / K√ºsk√ºl√ºk Kazƒ±", unit: "m3", price: 386.32 },
            { code: "C.3.3", name: "D√©blai rocheux / Kaya Kazƒ±", unit: "m3", price: 1308.96, a:{m:850, f:450, l:250, mat:0, prod:1200} },
            { code: "C.4.1", name: "D√©blai meuble d√©p√¥t", unit: "m3", price: 148.16 },
            { code: "C.4.2", name: "D√©blai semi-dur d√©p√¥t", unit: "m3", price: 307.70 },
            { code: "C.4.3", name: "D√©blai rocheux d√©p√¥t", unit: "m3", price: 893.10 },
            { code: "C.5.1", name: "Remblai emprunt / Ariyet", unit: "m3", price: 555.63, a:{m:600, f:350, l:180, mat:0, prod:1800} },
            { code: "C.6.1", name: "Assise drainante", unit: "m3", price: 1166.55 },
            { code: "C.7.1", name: "G√©otextile renfort", unit: "m2", price: 290.80 },
            { code: "C.7.2", name: "G√©otextile anti-contam", unit: "m2", price: 258.27 },
            { code: "C.7.3", name: "G√©ogrille", unit: "m2", price: 418.04 },
            { code: "C.8.1", name: "Arrondi cr√™te", unit: "ml", price: 317.01 },
            { code: "C.9.1", name: "Couche forme (CDF)", unit: "m3", price: 1346.55, a:{m:500, f:300, l:150, mat:0.5, prod:1500} },
            { code: "C.10.1", name: "Transport < 30km", unit: "M3xKM", price: 12.50 },
            { code: "C.10.2", name: "Transport > 30km", unit: "M3xKM", price: 11.00 },
            { code: "D.1.1", name: "Foss√© A", unit: "ml", price: 495.86 },
            { code: "D.1.2", name: "Foss√© B", unit: "ml", price: 594.94 },
            { code: "D.1.3", name: "Foss√© C", unit: "ml", price: 897.18 },
            { code: "D.1.4", name: "V√©g√©talisation", unit: "ml", price: 874.94 },
            { code: "D.2.1", name: "B√©tonnage A", unit: "ml", price: 4448.37 },
            { code: "D.2.2", name: "B√©tonnage B", unit: "ml", price: 5662.50 },
            { code: "D.2.3", name: "B√©tonnage C", unit: "ml", price: 6316.17 },
            { code: "D.3.1", name: "Cunette v√©g√©talis√©e", unit: "ml", price: 3402.40 },
            { code: "D.3.2", name: "Cunette b√©ton", unit: "ml", price: 4304.81 },
            { code: "D.3.3", name: "Cunette sym√©trique", unit: "ml", price: 4829.18 },
            { code: "D.4.1", name: "Descente A", unit: "ml", price: 2912.86 },
            { code: "D.4.2", name: "Descente B", unit: "ml", price: 3357.57 },
            { code: "D.4.3", name: "Descente C", unit: "ml", price: 3634.81 },
            { code: "D.4.4", name: "Descente D", unit: "ml", price: 4119.98 },
            { code: "D.5.1", name: "Descente tuile A", unit: "ml", price: 2200.00 },
            { code: "D.5.2", name: "Descente tuile B", unit: "ml", price: 3520.00 },
            { code: "D.5.3", name: "Descente tuile C", unit: "ml", price: 4200.00 },
            { code: "D.6.1", name: "Caniveau U 30x40", unit: "ml", price: 4800.00 },
            { code: "D.6.2", name: "Caniveau U 40x50", unit: "ml", price: 5800.00 },
            { code: "D.6.3", name: "Caniveau U 45x55", unit: "ml", price: 6300.00 },
            { code: "D.7.1", name: "Caniveau fente 300", unit: "ml", price: 22200.00 },
            { code: "D.7.2", name: "Caniveau fente 400", unit: "ml", price: 26600.00 },
            { code: "D.7.3", name: "Caniveau fente 500", unit: "ml", price: 29300.00 },
            { code: "D.7.4", name: "Renforcement", unit: "ml", price: 11191.83 },
            { code: "D.8.1", name: "Demi-buse 300", unit: "ml", price: 4400.00 },
            { code: "D.8.2", name: "Demi-buse 400", unit: "ml", price: 5700.00 },
            { code: "D.8.3", name: "Demi-buse 500", unit: "ml", price: 7800.00 },
            { code: "D.9.1", name: "D√©blai tranch√©e <2m", unit: "m3", price: 217.93 },
            { code: "D.9.2", name: "Tranch√©e 2-4m", unit: "m3", price: 277.24 },
            { code: "D.9.3", name: "Tranch√©e 4-6m", unit: "m3", price: 326.55 },
            { code: "D.9.4", name: "PV Roche tranch√©e", unit: "m3", price: 1500.00 },
            { code: "D.10.1", name: "Lit sable", unit: "m3", price: 1455.51 },
            { code: "D.10.2", name: "Lit b√©ton", unit: "m3", price: 5962.17 },
            { code: "D.11.1", name: "Enrobage grave", unit: "m3", price: 1437.35 },
            { code: "D.11.2", name: "Enrobage b√©ton", unit: "m3", price: 5593.89 },
            { code: "D.11.3", name: "Enrobage drainant", unit: "m3", price: 1739.65 },
            { code: "D.12.1", name: "Tuyau 400mm / BA Boru", unit: "ml", price: 7769.31 },
            { code: "D.12.2", name: "Tuyau 600mm / BA Boru", unit: "ml", price: 9369.31 },
            { code: "D.13.1", name: "Buse 800mm / BA B√ºz", unit: "ml", price: 15498.73 },
            { code: "D.13.2", name: "Buse 1000mm / BA B√ºz", unit: "ml", price: 21631.72 },
            { code: "D.13.3", name: "Buse 1200mm / BA B√ºz", unit: "ml", price: 36375.97 },
            { code: "D.13.4", name: "Buse 1500mm / BA B√ºz", unit: "ml", price: 50775.97 },
            { code: "D.14.1", name: "Collecteur 150mm", unit: "ml", price: 2700.00 },
            { code: "D.17.1", name: "Tuyau PEHD 75mm", unit: "ml", price: 1236.00 },
            { code: "D.17.2", name: "Tuyau PEHD 90mm", unit: "ml", price: 1500.00 },
            { code: "D.18.1", name: "Chambre K1C", unit: "U", price: 112000.00 },
            { code: "D.18.2", name: "Chambre K2C", unit: "U", price: 125000.00 },
            { code: "D.19.1", name: "Regard 1000mm", unit: "U", price: 120000.00 },
            { code: "D.20.1", name: "Puisard / Rogar", unit: "U", price: 150000.00 },
            { code: "D.20.2", name: "Puisard 1300", unit: "U", price: 174000.00 },
            { code: "D.20.3", name: "Puisard 1500", unit: "U", price: 188000.00 },
            { code: "D.20.4", name: "Puisard 1800", unit: "U", price: 215000.00 },
            { code: "D.20.5", name: "Puisard 2000", unit: "U", price: 220000.00 },
            { code: "D.20.6", name: "Puisard 2500", unit: "U", price: 260000.00 },
            { code: "D.21.1", name: "Grille 700x700", unit: "U", price: 32000.00 },
            { code: "D.21.2", name: "Grille 250x400", unit: "U", price: 26826.09 },
            { code: "D.21.3", name: "Caillebotis 1x1m", unit: "U", price: 5400.00 },
            { code: "D.21.4", name: "Caillebotis 1x2m", unit: "U", price: 9200.00 },
            { code: "D.22.1", name: "T√™te buse 600", unit: "U", price: 60925.34 },
            { code: "D.22.2", name: "T√™te buse 800", unit: "U", price: 68921.05 },
            { code: "D.22.3", name: "T√™te buse 1000", unit: "U", price: 76992.73 },
            { code: "D.22.4", name: "T√™te buse 1200", unit: "U", price: 90558.06 },
            { code: "D.22.5", name: "T√™te buse 1500", unit: "U", price: 125386.97 },
            { code: "D.23.1", name: "Bourrelet enrob√©", unit: "ml", price: 3000.00 },
            { code: "D.24.1", name: "Enrochement A", unit: "m3", price: 1879.30 },
            { code: "D.24.2", name: "Enrochement B", unit: "m3", price: 1879.30 },
            { code: "D.24.3", name: "Enrochement C", unit: "m3", price: 1879.30 },
            { code: "D.25.1", name: "Enrochement li√©", unit: "m3", price: 2042.98 },
            { code: "D.26.1", name: "Barbacane", unit: "ml", price: 1700.00 },
            { code: "D.27.1", name: "B√©ton propret√©", unit: "m3", price: 178.16 },
            { code: "D.27.2", name: "B√©ton ouvrages", unit: "m3", price: 9553.28 },
            { code: "D.27.3", name: "Coffrage", unit: "m2", price: 920.22 },
            { code: "D.27.4", name: "Ferraillage", unit: "kg", price: 65.08 },
            { code: "E.1.1", name: "Grave GNT / PMT", unit: "m3", price: 1922.64, a:{m:200, f:100, l:100, mat:3, prod:100} },
            { code: "E.2.1", name: "Grave Bitume GB", unit: "Tonne", price: 3390.32 },
            { code: "E.2.2", name: "Enrob√©s EME 2", unit: "Tonne", price: 4782.15 },
            { code: "E.3.1", name: "Couche BB / A≈üƒ±nma", unit: "Tonne", price: 4337.90 },
            { code: "E.4.1", name: "Impr√©gnation", unit: "m2", price: 95.00 },
            { code: "E.5.1", name: "Bicouche", unit: "m2", price: 540.00 },
            { code: "E.6.1", name: "Bordure A2", unit: "ml", price: 2000.00 },
            { code: "F.1.1", name: "Hachures", unit: "m2", price: 680.00 },
            { code: "F.1.2", name: "Bande 100mm", unit: "ml", price: 70.00 },
            { code: "F.1.3", name: "Bande 150mm", unit: "ml", price: 145.00 },
            { code: "F.1.4", name: "Bande 225mm", unit: "ml", price: 200.00 },
            { code: "F.1.5", name: "Bande 375mm", unit: "ml", price: 340.00 },
            { code: "F.1.6", name: "Bande 500mm", unit: "ml", price: 420.00 },
            { code: "F.1.7", name: "Fl√®che rabattement", unit: "U", price: 600.00 },
            { code: "F.1.8", name: "Fl√®che simple", unit: "U", price: 800.00 },
            { code: "F.1.9", name: "Fl√®che double", unit: "U", price: 820.00 },
            { code: "F.2.1", name: "Bande pr√©fa.", unit: "ml", price: 800.00 },
            { code: "G.1.1", name: "Panneau A/AB", unit: "U", price: 52000.00 },
            { code: "G.5.1", name: "Poteaux < 50", unit: "ml", price: 9776.59 },
            { code: "G.7.1", name: "R√©flecteur", unit: "U", price: 1670.00 },
            { code: "H.1.1.1", name: "Glissi√®re GS4", unit: "ml", price: 1238.45 },
            { code: "H.2.1.1", name: "Barri√®re GBA", unit: "ml", price: 3932.51 },
            { code: "I.1.1", name: "Fouilles murs", unit: "m3", price: 178.16 },
            { code: "I.1.3", name: "B√©ton propret√©", unit: "m3", price: 5919.19 },
            { code: "I.1.6", name: "B√©ton fondations", unit: "m3", price: 8973.98 },
            { code: "I.3.1", name: "Panneaux antibruit", unit: "m2", price: 88750.00 },
            { code: "I.5.3", name: "Enrochement / Ta≈ü Tahkimat", unit: "m3", price: 2205.85, a:{m:400, f:200, l:150, mat:5, prod:120} },
            { code: "I.6.1", name: "S√©parateur hydro.", unit: "U", price: 4400000.00 },
            { code: "I.8.1", name: "Cl√¥tures", unit: "ml", price: 5934.02 },
            { code: "I.9.1", name: "Plantation arbres", unit: "m2", price: 1545.17 },
            { code: "J.1.1", name: "Mur gabions", unit: "m3", price: 3034.57 },
            { code: "J.2.1", name: "B√©ton projet√©", unit: "m3", price: 13478.48 },
            { code: "J.2.3.1", name: "Clous 12m", unit: "U", price: 19236.87 },
            { code: "J.6.1", name: "Drains", unit: "ml", price: 4700.00 },
            { code: "J.8.1", name: "Ancrages 32mm", unit: "ml", price: 470.10 },
            { code: "J.11", name: "Atalus", unit: "m2", price: 18500.00 },
            { code: "J.12.1", name: "Terre Arm√©e / Toprakarme", unit: "m2", price: 13600.00, a:{m:500, f:300, l:400, mat:0, prod:1000} },
            { code: "K.1.1", name: "Cam√©ra", unit: "U", price: 412003.51 },
            { code: "NP.48", name: "D√©placement cimeti√®re", unit: "U", price: 22275.00 },
            { code: "OUA.B.1.1", name: "D√©blais fouilles / Temel Kazƒ±sƒ± (OA)", unit: "m3", price: 178.16, a:{m:400, f:200, l:150, mat:0, prod:800} },
            { code: "OUA.B.2.1", name: "Pieux 1200 mm / Fore Kazƒ±k", unit: "ml", price: 5404.19 },
            { code: "OUA.B.5.2.1", name: "B√©ton C40 Caisson", unit: "m3", price: 21343.02 },
            { code: "OUA.B.5.2.6", name: "B√©ton C35 Piles", unit: "m3", price: 12538.45 },
            { code: "OUA.B.6.1.1", name: "Acier HA / Demir", unit: "Tonne", price: 67033.93, a:{m:50, f:20, l:400, mat:350, prod:10} },
            { code: "OUA.B.6.1.2", name: "Treillis soud√©s / Hasƒ±r √áelik", unit: "Tonne", price: 69026.52, a:{m:40, f:15, l:300, mat:480, prod:12} },
            { code: "OUA.B.6.2", name: "Pr√©contrainte", unit: "Tonne", price: 55688.54 },
            { code: "OUA.B.7.1.1", name: "Appareil 2100", unit: "U", price: 260001.71 },
            { code: "OUA.B.7.5.1", name: "Joint 240mm", unit: "ml", price: 9389.70 },
            { code: "OUA.C.1", name: "Palplanches", unit: "m2", price: 25000.00 },
            { code: "OUA.NP.06", name: "Isolateur sismique", unit: "U", price: 134282.61 },
            { code: "OUA.NP.09a", name: "Tirants 45T / Ankraj 45T", unit: "ml", price: 4260.00, a:{m:350, f:100, l:250, mat:45, prod:40} },
            { code: "OUA.NP.08.41", name: "Drain perfor√©", unit: "ml", price: 2700.00 },
            { code: "OUA.D26.1", name: "Barbacane / Barbakan", unit: "ml", price: 1700, a:{m:50, f:10, l:80, mat:2, prod:150} },
            { code: "TUN.E.1.1", name: "Fondation GNT", unit: "m3", price: 1862.41 },
            { code: "TUN.E.1.3", name: "Enrob√© EME", unit: "Tonne", price: 4812.84 },
            { code: "TUN.C.1.2", name: "D√©blais explosif", unit: "m3", price: 4883.43 },
            { code: "TUN.C.3.1", name: "Boulons 4m", unit: "U", price: 2832.82 },
            { code: "TUN.D.2.1", name: "B√©ton projet√© / Shotcrete", unit: "m3", price: 13046.21, a:{m:650, f:250, l:300, mat:65, prod:80} },
            { code: "TUN.F.2.1", name: "Ventilateurs", unit: "U", price: 459359.84 },
            { code: "TU.E.3.1.1", name: "Panneau Tunnel", unit: "U", price: 11768.62 }
        ],

        // --- 2. Kƒ∞RALIK MAKƒ∞NE Lƒ∞STESƒ∞ ---
        dbMachines: [
            { name: "Ekskavat√∂r", price: 40000 },
            { name: "Bulldozer", price: 50000 },
            { name: "Greyder", price: 45000 },
            { name: "Loader", price: 35000 },
            { name: "Paletli Loader", price: 40000 },
            { name: "Kompakt√∂r (Silindir)", price: 20000 },
            { name: "Kamyon", price: 17000 },
            { name: "JCB", price: 10000 },
            { name: "Tƒ±r", price: 25000 },
            { name: "Lowbed", price: 30000 },
            { name: "Araz√∂z", price: 20000 },
            { name: "Shotcrete Makinesi", price: 40000 },
            { name: "Enjeksiyon Makinesi", price: 10000 }
        ],

        // --- FONKSƒ∞YONLAR ---
        login: function() {
            var val = document.getElementById("passInput").value;
            if(val.trim() === this.PASS) {
                document.getElementById("loginOverlay").style.display = "none";
                document.getElementById("appContainer").style.display = "block";
                localStorage.setItem("pro_master_v1", "ok");
                this.quote();
            } else {
                alert("Hatalƒ± ≈ûifre!");
            }
        },
        logout: function() { location.reload(); },

        toggleTheme: function() {
            document.body.setAttribute('data-theme', 
                document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'
            );
        },

        // --- Lƒ∞STE & ARAMA ---
        toggleList: function(type) {
            var listId = type === 'item' ? 'itemList' : 'machineList';
            var list = document.getElementById(listId);
            document.querySelectorAll('.dropdown-list').forEach(l => {
                if(l.id !== listId) l.style.display = 'none';
            });
            list.style.display = (list.style.display === 'block') ? 'none' : 'block';
            if(list.style.display === 'block') this.showList(type);
        },

        showList: function(type) {
            var inputId = type === 'item' ? 'searchBox' : 'machineBox';
            var listId = type === 'item' ? 'itemList' : 'machineList';
            var val = document.getElementById(inputId).value.toLocaleLowerCase('tr');
            var list = document.getElementById(listId);
            list.innerHTML = "";
            
            var source = type === 'item' ? this.dbItems : this.dbMachines;
            var filtered = source.filter(i => 
                i.name.toLocaleLowerCase('tr').includes(val) || (i.code && i.code.toLocaleLowerCase('tr').includes(val))
            );

            if(filtered.length === 0) list.innerHTML = "<div style='padding:15px; text-align:center; opacity:0.6;'>Bulunamadƒ±...</div>";

            filtered.forEach(item => {
                var div = document.createElement("div");
                div.className = "list-item";
                if(type === 'item') {
                    div.innerHTML = `<div><strong>${item.code}</strong><br>${item.name}</div>`;
                    div.onmousedown = () => { this.selectItem(item); };
                } else {
                    div.innerHTML = `<div><strong>${item.name}</strong></div><div>${this.fmt(item.price)}</div>`;
                    div.onmousedown = () => { this.addMachineCost(item); };
                }
                list.appendChild(div);
            });
        },

        filterList: function(type) { this.showList(type); },

        // --- SE√áƒ∞M & HESAP ---
        selectItem: function(item) {
            this.selItem = item;
            document.getElementById("searchBox").value = item.code + " - " + item.name;
            document.getElementById("itemList").style.display = "none";
            document.getElementById("unitDisplay").innerText = item.unit;
            document.getElementById("priceDisplay").value = this.fmt(item.price);
            
            // Eƒüer otomatik analiz varsa
            if(item.a) {
                this.fillAutoAnalysis(item.a);
            }
            this.calcRevenue();
        },

        addMachineCost: function(item) {
            this.addCostRow(item.name + " (Kira)", 1, item.price);
            document.getElementById("machineBox").value = "";
            document.getElementById("machineList").style.display = "none";
        },

        // Oto analiz doldurma
        fillAutoAnalysis: function(a) {
            document.getElementById("costContainer").innerHTML = "";
            var rate = parseFloat(document.getElementById("euroRate").value);
            var diesel = parseFloat(document.getElementById("dieselPrice").value);
            
            var unitFuel = (a.f * diesel) / a.prod; 
            var unitFixed = ((a.m + a.l) * rate) / a.prod;
            var unitMat = (a.mat * rate);

            this.addCostRow("Yakƒ±t (Analiz)", 1, unitFuel);
            this.addCostRow("Makine+ƒ∞≈ü√ßi (Analiz)", 1, unitFixed);
            if(a.mat > 0) this.addCostRow("Malzeme (Analiz)", 1, unitMat);
        },

        calcRevenue: function() {
            var q = parseFloat(document.getElementById("qtyInput").value) || 0;
            if(this.selItem) {
                this.totalRev = q * this.selItem.price;
                document.getElementById("revenueTotal").innerText = this.fmt(this.totalRev) + " DZD";
                
                // Analiz varsa miktarlarƒ± g√ºncelle
                document.querySelectorAll(".cost-inp.q").forEach(inp => {
                    if(inp.dataset.auto === "true") {
                        inp.value = q;
                        this.calcCosts();
                    }
                });
            }
            this.updateSummary();
        },
        
        recalc: function() { if(this.selItem && this.selItem.a) this.fillAutoAnalysis(this.selItem.a); },

        // --- MALƒ∞YET ---
        addCostRow: function(name="", qty="", price="") {
            var div = document.createElement("div");
            div.className = "cost-item";
            var isAuto = name.includes("(Analiz)");
            var qVal = isAuto && document.getElementById("qtyInput").value ? document.getElementById("qtyInput").value : qty;

            div.innerHTML = `
                <input class="cost-inp" value="${name}" placeholder="Gider Adƒ±">
                <input type="number" class="cost-inp q" data-auto="${isAuto}" value="${qVal}" placeholder="Miktar" onkeyup="app.calcCosts()">
                <input type="number" class="cost-inp p" value="${price}" placeholder="Fiyat" onkeyup="app.calcCosts()">
                <div class="del-btn" onclick="this.parentElement.remove(); app.calcCosts()">‚úï</div>
            `;
            document.getElementById("costContainer").appendChild(div);
            this.calcCosts();
        },

        calcCosts: function() {
            var total = 0;
            document.querySelectorAll(".cost-item").forEach(row => {
                var q = parseFloat(row.querySelector(".q").value) || 0;
                var p = parseFloat(row.querySelector(".p").value) || 0;
                total += q * p;
            });
            this.totalCost = total;
            this.updateSummary();
        },

        updateSummary: function() {
            var profit = this.totalRev - this.totalCost;
            document.getElementById("sumRev").innerText = this.fmt(this.totalRev);
            document.getElementById("sumCost").innerText = this.fmt(this.totalCost);
            
            var pEl = document.getElementById("sumProfit");
            pEl.innerText = this.fmt(profit);
            pEl.className = "bot-profit " + (profit >= 0 ? "plus" : "minus");
            pEl.innerText = (profit >= 0 ? "+ " : "") + pEl.innerText;
        },

        fmt: function(n) { return n.toLocaleString('tr-TR', {minimumFractionDigits: 2, maximumFractionDigits: 2}); },
        
        newQuote: function() {
            var q = ["Zor yollar g√ºzel yerlere √ßƒ±kar.", "ƒ∞≈üleyen demir ƒ±≈üƒ±ldar.", "G√ºvenlik hƒ±zdan √∂nce gelir."];
            document.querySelector(".quote").innerText = '"' + q[Math.floor(Math.random()*q.length)] + '"';
        }
    };

    // Ba≈ülangƒ±√ß
    document.getElementById("passInput").addEventListener("keypress", function(e){ if(e.key==="Enter") app.login(); });
    
    if(localStorage.getItem("pro_master_v1") === "ok") {
        document.getElementById("loginOverlay").style.display = "none";
        document.getElementById("appContainer").style.display = "block";
        app.newQuote();
    }
    
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.search-box')) {
            document.querySelectorAll('.dropdown-list').forEach(el => el.style.display = 'none');
        }
    });

</script>
</body>
</html>
