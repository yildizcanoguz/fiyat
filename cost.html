<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MASTER DQE & ANALYSE</title>
    <style>
        /* --- MODERN VE SAƒûLAM TASARIM --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; padding: 0; background-color: #eef2f5; color: #333; 
            height: 100vh; overflow: hidden;
        }

        /* Gƒ∞Rƒ∞≈û EKRANI */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #eef2f5 0%, #dbe2e8 100%);
            z-index: 99999; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .login-box {
            background: white; padding: 40px 30px; border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1); width: 85%; max-width: 350px;
            text-align: center; border: 1px solid #fff;
        }
        .login-input {
            width: 100%; padding: 15px; margin: 20px 0; border: 2px solid #e1e4e8; 
            border-radius: 12px; font-size: 24px; text-align: center; letter-spacing: 5px; 
            background: #f9fbfd; transition: all 0.3s;
        }
        .login-input:focus { border-color: #007aff; background: #fff; }
        .login-btn {
            width: 100%; padding: 15px; background: #007aff; color: white;
            border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,122,255,0.3);
        }

        /* ANA UYGULAMA */
        #appContainer {
            display: none; max-width: 600px; margin: 0 auto; height: 100%; overflow-y: auto;
            padding: 15px; padding-bottom: 120px;
        }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .app-title { font-size: 20px; font-weight: 900; color: #007aff; letter-spacing: -0.5px; }
        .logout-btn { background: #ff3b30; color: white; border: none; padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 700; cursor: pointer; }

        /* PARAMETRELER */
        .params-panel {
            background: #fff; padding: 12px; border-radius: 16px; margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03); border: 1px solid #e1e4e8;
            display: flex; gap: 10px;
        }
        .param-group { flex: 1; text-align: center; }
        .param-label { font-size: 10px; color: #8e8e93; font-weight: 700; text-transform: uppercase; margin-bottom: 5px; display: block; }
        .param-input { width: 100%; padding: 8px; border: 1px solid #e1e4e8; border-radius: 8px; font-size: 14px; font-weight: 600; text-align: center; background: #f9fbfd; color: #333; }

        /* DROPBOX MEN√ú */
        .search-container { position: relative; margin-bottom: 20px; z-index: 1000; }
        .search-box-wrapper {
            display: flex; align-items: center; background: #fff; border: 2px solid #007aff;
            border-radius: 14px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,122,255,0.1);
        }
        
        .search-input { 
            flex: 1; padding: 16px; border: none; font-size: 15px; font-weight: 600; outline: none;
        }
        .dropdown-btn {
            padding: 16px 20px; background: #f0f2f5; color: #007aff; font-size: 12px; cursor: pointer;
            border-left: 1px solid #e1e4e8; font-weight: 800; user-select: none;
        }
        .dropdown-btn:active { background: #e0e6ed; }

        .results-list {
            display: none; position: absolute; top: 110%; left: 0; right: 0;
            background: white; border-radius: 14px; max-height: 350px; overflow-y: auto;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2); border: 1px solid #e1e4e8; padding: 5px;
        }
        .res-item { padding: 14px; border-radius: 8px; cursor: pointer; border-bottom: 1px solid #f9f9f9; display: flex; align-items: center; }
        .res-item:active { background: #f2f7ff; }
        .res-icon { width: 32px; height: 32px; border-radius: 8px; background: #eaf3ff; color: #007aff; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-size: 16px; font-weight: bold; flex-shrink: 0; }
        
        /* ANALƒ∞Z KARTI */
        .analysis-card {
            background: #fff; border-radius: 20px; overflow: hidden; margin-top: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08); display: none; margin-bottom: 30px;
            border: 1px solid #e1e4e8;
        }
        .ac-header { background: linear-gradient(135deg, #007aff, #005ecb); color: white; padding: 15px 20px; }
        .ac-title { font-size: 16px; font-weight: 800; margin: 0; }
        .ac-code { font-size: 12px; opacity: 0.8; margin-top: 2px; display: block; }
        
        .ac-body { padding: 20px; }
        .ac-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 13px; border-bottom: 1px dashed #eee; padding-bottom: 8px; }
        .ac-label { color: #666; font-weight: 600; }
        .ac-val { font-weight: 700; color: #333; }
        
        .ac-total { margin-top: 15px; background: #f8f9fa; padding: 15px; border-radius: 12px; text-align: center; border: 2px solid #007aff; }
        .ac-total-label { font-size: 11px; color: #888; text-transform: uppercase; font-weight: 800; letter-spacing: 1px; }
        .ac-total-val { font-size: 24px; font-weight: 900; color: #007aff; display: block; margin-top: 5px; }

        /* HESAPLAMA ALANI */
        .calc-area { margin-top: 20px; display: none; }
        .calc-input { width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 12px; font-size: 16px; font-weight: bold; text-align: center; }
        .grand-result { text-align: center; font-size: 20px; font-weight: bold; color: #333; margin-top: 10px; }
        
        /* MALƒ∞YET KALEMLERƒ∞ */
        .cost-section { margin-top: 30px; padding-top: 20px; border-top: 2px dashed #ccc; display:none; }
        .cost-title { font-size: 16px; font-weight: 800; color: #e67e22; margin-bottom: 10px; }
        .cost-row { display: flex; gap: 5px; margin-bottom: 10px; }
        .cost-input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
        .add-cost-btn { width: 100%; padding: 12px; background: #27ae60; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .cost-total-display { text-align: right; font-size: 18px; font-weight: 900; color: #e67e22; margin-top: 15px; }

        /* G√úN√úN S√ñZ√ú */
        .quote-card { margin-top: 40px; padding: 20px; background: white; border-radius: 16px; text-align: center; border-bottom: 4px solid #007aff; cursor: pointer; color: #555; }
        .q-text { font-size: 13px; font-style: italic; margin-bottom: 8px; line-height: 1.4; }
        .q-author { font-size: 10px; font-weight: 800; color: #007aff; text-transform: uppercase; }

    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-box">
        <h2 style="margin:0 0 10px 0; color:#2c3e50;">DQE & ANALYSE</h2>
        <p style="color:#666; font-size:13px; margin-bottom:20px;">G√úVENLƒ∞ Gƒ∞Rƒ∞≈û / SECURE ACCESS</p>
        <input type="password" id="passInput" class="login-input" placeholder="****" inputmode="numeric">
        <button class="login-btn" onclick="app.login()">Gƒ∞Rƒ∞≈û YAP</button>
        <p id="errorMsg" style="color:#ff3b30; display:none; margin-top:15px; font-weight:bold; font-size:13px;">Hatalƒ± ≈ûifre!</p>
    </div>
</div>

<div id="appContainer">
    <div class="header">
        <div class="app-title">PROJE ANALƒ∞Z üìä</div>
        <button class="logout-btn" onclick="app.logout()">√áIKI≈û</button>
    </div>

    <div class="params-panel">
        <div class="param-group">
            <label class="param-label">Mazot (DZD)</label>
            <input type="number" id="dieselPrice" class="param-input" value="29.01" onkeyup="app.recalcAnalysis()">
        </div>
        <div class="param-group">
            <label class="param-label">Euro Kuru</label>
            <input type="number" id="euroRate" class="param-input" value="107.31" onkeyup="app.recalcAnalysis()">
        </div>
    </div>

    <label style="font-weight:700; color:#555; margin-left:5px; margin-bottom:5px; display:block;">ƒ∞≈ü Kalemi Se√ß / S√©lectionnez:</label>

    <div class="search-container">
        <div class="search-box-wrapper">
            <input type="text" id="searchBox" class="search-input" placeholder="Poz Ara / Rechercher..." onkeyup="app.filterList()" onfocus="app.showList()" autocomplete="off">
            <div class="dropdown-btn" onclick="app.toggleList(event)">‚ñº Lƒ∞STE</div>
        </div>
        <div id="resList" class="results-list"></div>
    </div>

    <div id="analysisCard" class="analysis-card">
        <div class="ac-header">
            <h3 class="ac-title" id="acName">...</h3>
        </div>
        <div class="ac-body"></div>
    </div>

    <div id="calcSec" class="calc-area">
        <label class="param-label" style="text-align:left;">Mƒ∞KTAR Gƒ∞Rƒ∞Nƒ∞Z (Quantit√©):</label>
        <input type="number" id="qtyIn" class="calc-input" placeholder="0" onkeyup="app.calculateTotal()">
        <div class="grand-result" id="grandTotalDisplay">0 DZD</div>
    </div>
    
    <div id="costSection" class="cost-section">
        <div class="cost-title">MALƒ∞YET KALEMLERƒ∞ (Gƒ∞DER)</div>
        <div id="costRows"></div>
        <button class="add-cost-btn" onclick="app.addCostRow()">+ Kalem Ekle</button>
        <div class="cost-total-display" id="totalCostDisplay">TOPLAM Gƒ∞DER: 0 DZD</div>
    </div>

    <div class="quote-card" onclick="app.newQuote()">
        <div style="font-size:24px; color:#ccc; margin-top:-10px;">‚ùù</div>
        <p id="qText" class="q-text">...</p>
        <div id="qAuthor" class="q-author"></div>
    </div>
</div>

<script>
    var app = {
        PASS: "1907",
        selItem: null,
        currentUnitPrice: 0,
        
        // --- SENƒ∞N DOSYALARINDAN √áIKARILAN GER√áEK VERƒ∞LER ---
        db: [
            {n:"Kazƒ± ƒ∞≈üi (Genel) / D√©blai", u:"m3", prod:3600, fuel:1260.8, fixed:5555.54}, 
            {n:"Dolgu ƒ∞≈üi / Remblai", u:"m3", prod:107.3, fuel:1260.8, fixed:6786.33},
            {n:"Shotcrete / P√ºsk√ºrtme Beton", u:"m3", prod:1, fuel:274.4, fixed:12017.17},
            {n:"Ankraj (Pasif) / Tirants", u:"ml", prod:1, fuel:284.0, fixed:3382.45},
            {n:"Hasƒ±r √áelik / Treillis Soud√©s", u:"Ton", prod:1, fuel:76.0, fixed:8060.16},
            {n:"Barbakan / Barbacane", u:"ml", prod:1, fuel:124.0, fixed:3708.7},
            {n:"Ankraj Testi / Essai", u:"Adet", prod:1, fuel:76.0, fixed:1397.57},
            {n:"Anrochman (Ta≈ü Dolgu)", u:"m3", prod:107.3, fuel:1248.0, fixed:25480.23},
            {n:"Riprap (Ta≈ü Tahkimat)", u:"m3", prod:107.3, fuel:1164.8, fixed:4832.32},
            {n:"GNT (Temel Malzemesi)", u:"m3", prod:107.3, fuel:1175.04, fixed:4052.24},
            {n:"CDF (Form Tabakasƒ±)", u:"m3", prod:107.3, fuel:1164.8, fixed:24774.81},
            {n:"Toprakarme / Terre Arm√©e", u:"m2", prod:107.3, fuel:1425.8, fixed:3605.28},
            {n:"Nebati Sƒ±yƒ±rma / D√©capage", u:"m3", prod:107.3, fuel:1267.2, fixed:1324.04},
            {n:"√áevre D√ºzenlemesi", u:"m2", prod:107.3, fuel:1164.8, fixed:3172.83}
        ],

        // --- FONKSƒ∞YONLAR ---
        login: function() {
            var val = document.getElementById("passInput").value;
            if(val.trim() === this.PASS) {
                document.getElementById("loginOverlay").style.display = "none";
                document.getElementById("appContainer").style.display = "block";
                localStorage.setItem("master_v12", "ok");
                this.newQuote();
                this.addCostRow(); // Ba≈ülangƒ±√ßta bir bo≈ü satƒ±r ekle
            } else {
                document.getElementById("errorMsg").style.display = "block";
            }
        },

        logout: function() {
            localStorage.removeItem("master_v12");
            location.reload();
        },

        toggleList: function(event) {
            if(event) event.stopPropagation(); 
            var list = document.getElementById("resultsList");
            if(list.style.display === "block") list.style.display = "none";
            else this.showList();
        },

        showList: function() {
            var val = document.getElementById("searchBox").value.toLocaleLowerCase('tr');
            var list = document.getElementById("resultsList");
            list.innerHTML = "";
            
            var filtered = this.db.filter(i => i.n.toLocaleLowerCase('tr').includes(val));

            filtered.forEach(item => {
                var div = document.createElement("div");
                div.className = "res-item";
                div.innerHTML = `<div class="res-icon">‚û§</div><div><strong>${item.n}</strong></div>`;
                div.onmousedown = () => { this.selectItem(item); };
                list.appendChild(div);
            });
            list.style.display = "block";
        },

        filterList: function() { this.showList(); },

        selectItem: function(item) {
            this.selItem = item;
            document.getElementById("searchBox").value = item.n;
            document.getElementById("resultsList").style.display = "none";
            this.renderCard();
        },

        renderCard: function() {
            var item = this.selItem;
            var card = document.getElementById("analysisCard");
            var dieselP = parseFloat(document.getElementById("dieselPrice").value.replace(',','.'));
            var euroR = parseFloat(document.getElementById("euroRate").value.replace(',','.'));

            document.getElementById("acName").innerText = item.n;
            card.style.display = "block";
            document.getElementById("calcSec").style.display = "block";
            document.getElementById("costSection").style.display = "block";

            // ANALƒ∞Z HESABI
            // G√ºnl√ºk Toplam = (Yakƒ±t Lt * Mazot Fiyatƒ± / Euro Kuru) + Sabit Giderler
            // Birim Fiyat = G√ºnl√ºk Toplam / G√ºnl√ºk √úretim
            
            var dailyFuelCostEUR = (item.fuel * dieselP) / euroR;
            var totalDailyEUR = dailyFuelCostEUR + item.fixed;
            var unitPriceEUR = totalDailyEUR / item.prod;
            var unitPriceDZD = unitPriceEUR * euroR;

            this.currentUnitPrice = unitPriceDZD;

            document.querySelector(".ac-body").innerHTML = `
                <div class="ac-row"><span class="ac-label">G√ºnl√ºk √úretim:</span> <span class="ac-val">${this.fmt(item.prod)} ${item.u}</span></div>
                <div class="ac-row"><span class="ac-label">G√ºnl√ºk Yakƒ±t:</span> <span class="ac-val">${this.fmt(item.fuel)} Lt</span></div>
                <div class="ac-row"><span class="ac-label">Sabit Gider (Makine+ƒ∞≈ü√ßi):</span> <span class="ac-val">${this.fmt(item.fixed)} ‚Ç¨</span></div>
                
                <div class="ac-total" style="background:#eaf3ff; border:2px solid #007aff; border-radius:12px; padding:15px; margin-top:15px; text-align:center;">
                    <div style="font-size:11px; font-weight:bold; color:#888;">ANALƒ∞Z Bƒ∞Rƒ∞M Fƒ∞YATI</div>
                    <div style="font-size:24px; font-weight:900; color:#007aff;">${this.fmt(unitPriceDZD)} DZD</div>
                    <div style="font-size:13px; color:#555;">(${this.fmt(unitPriceEUR)} ‚Ç¨)</div>
                </div>
            `;
            
            document.getElementById("qtyIn").value = "";
            document.getElementById("grandTotalDisplay").innerText = "0 DZD";
        },

        recalcAnalysis: function() { if(this.selItem) this.renderCard(); },

        calculateTotal: function() {
            if(!this.selItem) return;
            var q = parseFloat(document.getElementById("qtyIn").value);
            if(q > 0) {
                 var total = q * this.currentUnitPrice;
                 document.getElementById("grandTotalDisplay").innerText = this.fmt(total) + " DZD";
            }
        },

        // --- MALƒ∞YET EKLEME ---
        addCostRow: function() {
            var container = document.getElementById("costRows");
            var div = document.createElement("div");
            div.className = "cost-row";
            div.innerHTML = `
                <input type="text" class="cost-input" placeholder="Kalem Adƒ± (√ñrn: Beton)" style="flex:2">
                <input type="number" class="cost-input" placeholder="Miktar" onkeyup="app.calcCosts()">
                <input type="number" class="cost-input" placeholder="B.Fiyat" onkeyup="app.calcCosts()">
                <div style="padding:10px; font-weight:bold; color:#e67e22;" class="row-total">0</div>
            `;
            container.appendChild(div);
        },

        calcCosts: function() {
            var total = 0;
            var rows = document.querySelectorAll(".cost-row");
            rows.forEach(row => {
                var inputs = row.querySelectorAll("input");
                var q = parseFloat(inputs[1].value) || 0;
                var p = parseFloat(inputs[2].value) || 0;
                var sum = q * p;
                row.querySelector(".row-total").innerText = this.fmt(sum);
                total += sum;
            });
            document.getElementById("totalCostDisplay").innerText = "TOPLAM Gƒ∞DER: " + this.fmt(total) + " DZD";
        },

        fmt: function(n) { return n.toLocaleString('tr-TR', {minimumFractionDigits: 2, maximumFractionDigits: 2}); },

        quotes: [
            {t:"ƒ∞≈üleyen demir ƒ±≈üƒ±ldar.", a:"Atas√∂z√º"},
            {t:"Yol medeniyettir.", a:"Atas√∂z√º"},
            {t:"≈ûantiyede g√ºvenlik, hƒ±zdan √∂nce gelir.", a:"Kural"}
        ],
        newQuote: function() {
            var r = this.quotes[Math.floor(Math.random() * this.quotes.length)];
            document.getElementById("qText").innerText = '"' + r.t + '"';
            document.getElementById("qAuthor").innerText = "‚Äî " + r.a;
        }
    };

    // BA≈ûLANGI√á
    document.getElementById("passInput").addEventListener("keypress", function(e){ if(e.key==="Enter") app.login(); });
    
    if(localStorage.getItem("master_v12") === "ok") {
        document.getElementById("loginOverlay").style.display = "none";
        document.getElementById("appContainer").style.display = "block";
        app.newQuote();
        app.addCostRow();
    }
    
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.search-container')) document.getElementById("resultsList").style.display = "none";
    });

</script>

</body>
</html>
