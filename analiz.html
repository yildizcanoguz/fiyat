<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MASTER DQE & ANALYSE</title>
    <style>
        /* --- MODERN VE SAƒûLAM TASARIM --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; padding: 0; background-color: #eef2f5; color: #333; 
            height: 100vh; overflow: hidden;
        }

        /* Gƒ∞Rƒ∞≈û EKRANI */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #eef2f5 0%, #dbe2e8 100%);
            z-index: 99999; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .login-box {
            background: white; padding: 40px 30px; border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1); width: 85%; max-width: 350px;
            text-align: center; border: 1px solid #fff;
        }
        .login-input {
            width: 100%; padding: 15px; margin: 20px 0; border: 2px solid #e1e4e8; 
            border-radius: 12px; font-size: 24px; text-align: center; letter-spacing: 5px; 
            background: #f9fbfd; transition: all 0.3s;
        }
        .login-input:focus { border-color: #007aff; background: #fff; }
        .login-btn {
            width: 100%; padding: 15px; background: #007aff; color: white;
            border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,122,255,0.3);
        }

        /* ANA UYGULAMA */
        #appContainer {
            display: none; max-width: 600px; margin: 0 auto; height: 100%; overflow-y: auto;
            padding: 15px; padding-bottom: 150px;
        }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .app-title { font-size: 20px; font-weight: 900; color: #007aff; letter-spacing: -0.5px; }
        .logout-btn { background: #ff3b30; color: white; border: none; padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 700; cursor: pointer; }

        /* PARAMETRELER */
        .params-panel {
            background: #fff; padding: 12px; border-radius: 16px; margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03); border: 1px solid #e1e4e8;
            display: flex; gap: 10px;
        }
        .param-group { flex: 1; text-align: center; }
        .param-label { font-size: 10px; color: #8e8e93; font-weight: 700; text-transform: uppercase; margin-bottom: 5px; display: block; }
        .param-input { width: 100%; padding: 8px; border: 1px solid #e1e4e8; border-radius: 8px; font-size: 14px; font-weight: 600; text-align: center; background: #f9fbfd; color: #333; }

        /* SEKMELER */
        .tabs { display: flex; gap: 5px; margin-bottom: 15px; background: #e0e0e0; padding: 4px; border-radius: 12px; }
        .tab-btn { flex: 1; padding: 8px 0; border: none; background: transparent; font-weight: 700; color: #666; border-radius: 9px; font-size: 11px; text-align: center; cursor: pointer; }
        .tab-btn.active { background: #007aff; color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* DROPBOX MEN√ú (D√úZELTƒ∞LDƒ∞) */
        .search-container { position: relative; margin-bottom: 20px; z-index: 1000; }
        .search-box-wrapper {
            display: flex; align-items: center; background: #fff; border: 2px solid #e1e4e8;
            border-radius: 14px; overflow: hidden; transition: all 0.3s;
        }
        .search-box-wrapper:focus-within { border-color: #007aff; box-shadow: 0 0 0 4px rgba(0,122,255,0.1); }
        
        .search-input { 
            flex: 1; padding: 16px; border: none; font-size: 15px; font-weight: 500; outline: none;
        }
        
        .dropdown-btn {
            padding: 16px 20px; background: #f0f2f5; color: #007aff; font-size: 12px; cursor: pointer;
            border-left: 1px solid #e1e4e8; font-weight: 800; user-select: none;
        }
        .dropdown-btn:active { background: #e0e6ed; }

        .results-list {
            display: none; position: absolute; top: 110%; left: 0; right: 0;
            background: white; border-radius: 14px; max-height: 350px; overflow-y: auto;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2); border: 1px solid #e1e4e8; padding: 5px;
        }
        .res-item { padding: 12px; border-radius: 8px; cursor: pointer; border-bottom: 1px solid #f9f9f9; display: flex; align-items: center; }
        .res-item:active { background: #f2f7ff; }
        .res-icon { width: 32px; height: 32px; border-radius: 8px; background: #eaf3ff; color: #007aff; display: flex; align-items: center; justify-content: center; margin-right: 10px; font-size: 14px; font-weight: bold; flex-shrink: 0; }
        
        /* ANALƒ∞Z KARTI */
        .analysis-card {
            background: #fff; border-radius: 20px; overflow: hidden; margin-top: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08); display: none; margin-bottom: 30px;
            border: 1px solid #e1e4e8;
        }
        .ac-header { background: linear-gradient(135deg, #007aff, #005ecb); color: white; padding: 15px 20px; }
        .ac-title { font-size: 16px; font-weight: 800; margin: 0; }
        .ac-code { font-size: 12px; opacity: 0.8; margin-top: 2px; display: block; }
        
        .ac-body { padding: 20px; }
        .ac-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 13px; border-bottom: 1px dashed #eee; padding-bottom: 8px; }
        .ac-label { color: #666; font-weight: 600; }
        .ac-val { font-weight: 700; color: #333; }
        
        .ac-total { margin-top: 15px; background: #f8f9fa; padding: 15px; border-radius: 12px; text-align: center; border: 2px solid #007aff; }
        .ac-total-label { font-size: 11px; color: #888; text-transform: uppercase; font-weight: 800; letter-spacing: 1px; }
        .ac-total-val { font-size: 24px; font-weight: 900; color: #007aff; display: block; margin-top: 5px; }

        /* HESAPLAMA */
        .calc-area { margin-top: 20px; display: none; }
        .calc-input { width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 12px; font-size: 16px; font-weight: bold; text-align: center; }
        .grand-result { text-align: center; font-size: 20px; font-weight: bold; color: #333; margin-top: 10px; }

        /* G√úN√úN S√ñZ√ú */
        .quote-card { margin-top: 30px; padding: 20px; background: white; border-radius: 16px; text-align: center; border-bottom: 4px solid #007aff; cursor: pointer; color: #555; }
        .q-text { font-size: 13px; font-style: italic; margin-bottom: 8px; line-height: 1.4; }
        .q-author { font-size: 10px; font-weight: 800; color: #007aff; text-transform: uppercase; }

        .no-res { padding: 20px; text-align: center; color: #999; font-style: italic; font-size: 13px; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-box">
        <h2 style="margin:0 0 10px 0; color:#2c3e50;">DQE & ANALYSE</h2>
        <p style="color:#666; font-size:13px; margin-bottom:20px;">G√úVENLƒ∞ Gƒ∞Rƒ∞≈û / SECURE ACCESS</p>
        <input type="password" id="passInput" class="login-input" placeholder="****" inputmode="numeric">
        <button class="login-btn" onclick="app.login()">Gƒ∞Rƒ∞≈û YAP</button>
        <p id="errorMsg" style="color:#ff3b30; display:none; margin-top:15px; font-weight:bold; font-size:13px;">Hatalƒ± ≈ûifre!</p>
    </div>
</div>

<div id="appContainer">
    <div class="header">
        <div class="app-title">MASTER DQE üèóÔ∏è</div>
        <button class="logout-btn" onclick="app.logout()">√áIKI≈û</button>
    </div>

    <div class="params-panel">
        <div class="param-group">
            <label class="param-label">Mazot (DZD/Lt)</label>
            <input type="number" id="dieselPrice" class="param-input" value="29.01" onkeyup="app.recalcAnalysis()">
        </div>
        <div class="param-group">
            <label class="param-label">Euro Kuru</label>
            <input type="number" id="euroRate" class="param-input" value="107.31" onkeyup="app.recalcAnalysis()">
        </div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="app.setTab('ALL', this)">HEPSƒ∞</button>
        <button class="tab-btn" onclick="app.setTab('ROUTE', this)">YOL</button>
        <button class="tab-btn" onclick="app.setTab('OA', this)">SANAT</button>
        <button class="tab-btn" onclick="app.setTab('TUNNEL', this)">T√úNEL</button>
    </div>

    <div class="search-container">
        <div class="search-box-wrapper">
            <input type="text" id="searchBox" class="search-input" placeholder="Poz Ara / Rechercher..." onkeyup="app.filterList()" onfocus="app.showList()" autocomplete="off">
            <div class="dropdown-btn" onclick="app.toggleList(event)">‚ñº Lƒ∞STE</div>
        </div>
        <div id="resList" class="results-list"></div>
    </div>

    <div id="analysisCard" class="analysis-card">
        <div class="ac-header">
            <h3 class="ac-title" id="acName">...</h3>
            <span class="ac-code" id="acCode">...</span>
        </div>
        <div class="ac-body"></div>
    </div>

    <div id="calcSec" class="calc-area">
        <label class="param-label" style="text-align:left;">Mƒ∞KTAR Gƒ∞Rƒ∞Nƒ∞Z:</label>
        <input type="number" id="qtyIn" class="calc-input" placeholder="0" onkeyup="app.calculateTotal()">
        <div class="grand-result" id="grandTotalDisplay">0 DZD</div>
    </div>

    <div class="quote-card" onclick="app.newQuote()">
        <div style="font-size:24px; color:#ccc; margin-top:-10px;">‚ùù</div>
        <p id="qText" class="q-text">...</p>
        <div id="qAuthor" class="q-author"></div>
    </div>
</div>

<script>
    var app = {
        PASS: "1907",
        selItem: null,
        filterTab: 'ALL',
        
        // --- VERITABANI: SENƒ∞N DOSYALARINDAN ALINAN %100 GER√áEK VERƒ∞LER ---
        // a: {m:Makine, f:Yakƒ±t, l:ƒ∞≈ü√ßilik, mat:Malzeme, prod:G√ºnl√ºk √úretim}
        db: [
            // KAZI VE DOLGU (Kazƒ±.csv, Dolgu.csv, cdf.csv, riprap.csv)
            {l:"ROUTE", c:"C.3.1", n:"D√©blai meuble / Yumu≈üak Kazƒ±", u:"m3", d:257.24, e:1.20, a:{m:450, f:280, l:150, mat:0, prod:3600}},
            {l:"ROUTE", c:"C.3.3", n:"D√©blai rocheux / Kaya Kazƒ±", u:"m3", d:1308.96, e:4.80, a:{m:850, f:450, l:250, mat:0, prod:1200}},
            {l:"ROUTE", c:"C.5.1", n:"Remblai / Dolgu ƒ∞≈üleri", u:"m3", d:555.63, e:1.90, a:{m:269.25, f:150, l:180, mat:0, prod:1800}},
            {l:"ROUTE", c:"C.1.1", n:"D√©capage / Sƒ±yƒ±rma Kazƒ±sƒ± (Nebati)", u:"m3", d:128.62, e:0.60, a:{m:269.25, f:160, l:100, mat:0, prod:192}},
            {l:"ROUTE", c:"C.9.1", n:"Couche de forme / Form Tabakasƒ± (CDF)", u:"m3", d:1346.55, e:1.50, a:{m:500, f:300, l:150, mat:0.5, prod:960}},
            {l:"ROUTE", c:"I.5.3", n:"Enrochement / Riprap (Ta≈ü Tahkimat)", u:"m3", d:2205.85, e:10.50, a:{m:269.25, f:200, l:144, mat:5, prod:120}},
            {l:"ROUTE", c:"E.1.1", n:"Grave GNT / PMT (Temel)", u:"m3", d:1922.64, e:3.20, a:{m:0, f:0, l:66, mat:3, prod:96}},

            // SANAT YAPILARI (Ankraj.csv, Hasƒ±r √áelik.csv, Barbakan.csv, Toprakarme.csv)
            {l:"OA", c:"OUA.NP.09a", n:"Tirants 45T / Pasif Ankraj", u:"ml", d:4260, e:89, a:{m:245, f:64, l:200, mat:45, prod:100}},
            {l:"OA", c:"OUA.NP.09c", n:"Essai Ankraj / Ankraj Testi", u:"U", d:35832, e:133, a:{m:24.5, f:64, l:150, mat:0, prod:6}},
            {l:"OA", c:"OUA.B6.1.2", n:"Treillis soud√©s / Hasƒ±r √áelik", u:"Ton", d:69026.52, e:527.60, a:{m:96, f:64, l:300, mat:480, prod:1.4}},
            {l:"OA", c:"OUA.D26.1", n:"Barbacane / Barbakan (PVC)", u:"ml", d:1700, e:0, a:{m:0, f:0, l:50, mat:2, prod:150}},
            {l:"OA", c:"OUA.J12.1", n:"Terre Arm√©e / Toprakarme", u:"m2", d:13600, e:0, a:{m:275, f:200, l:300, mat:0, prod:1000}},
            {l:"OA", c:"OUA.B1.7", n:"Enrochement / Anrochman (Ta≈ü Dolgu)", u:"m3", d:1245.4, e:2, a:{m:275, f:130, l:150, mat:0, prod:780}},
            {l:"OA", c:"OUA.I9.1", n:"Plantation / √áevre D√ºzenlemesi", u:"m2", d:1545.17, e:0, a:{m:269, f:0, l:151, mat:0, prod:1}},

            // T√úNEL (Shotcrete.csv)
            {l:"TUNNEL", c:"TUN.D2.1", n:"B√©ton projet√© / Shotcrete (P√ºsk√ºrtme)", u:"m3", d:13046.21, e:97.30, a:{m:6.05, f:0, l:0.62, mat:615, prod:1}},

            // Dƒ∞ƒûER STANDART POZLAR (Analizi Olmayanlar)
            {l:"ROUTE", c:"A1", n:"Installation / ≈ûantiye Kurulumu", u:"Ft", d:1041277260, e:4972851},
            {l:"ROUTE", c:"E2.1", n:"Grave Bitume / Bit√ºml√º Temel", u:"Ton", d:3390, e:21.6},
            {l:"ROUTE", c:"E3.1", n:"Couche Roulement / A≈üƒ±nma", u:"Ton", d:4337, e:27},
            {l:"ROUTE", c:"D12.1", n:"Tuyau 400mm / Boru", u:"ml", d:7769, e:0.3},
            {l:"ROUTE", c:"NP.48", n:"D√©placement cimeti√®re / Mezarlƒ±k", u:"U", d:22275, e:0},
            {l:"OA", c:"OUA.B7.1", n:"Appareil d'appui / Mesnet", u:"U", d:260001, e:3812},
            {l:"OA", c:"OUA.NP.06", n:"Isolateur / Sismik ƒ∞zolat√∂r", u:"U", d:134282, e:15822},
            {l:"TUNNEL", c:"TUN.F2.1", n:"Ventilateurs / Fanlar", u:"U", d:459359, e:85315}
        ],

        // --- FONKSƒ∞YONLAR ---
        login: function() {
            if(document.getElementById("passInput").value.trim() === this.PASS) {
                document.getElementById("loginOverlay").style.display = "none";
                document.getElementById("appContainer").style.display = "block";
                localStorage.setItem("master_v10", "ok");
                this.newQuote();
            } else {
                document.getElementById("errorMsg").style.display = "block";
            }
        },

        logout: function() {
            localStorage.removeItem("master_v10");
            location.reload();
        },

        setTab: function(t, btn) {
            this.filterTab = t;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            this.showList();
        },

        toggleList: function(event) {
            if(event) event.stopPropagation(); // Tƒ±klama √ßakƒ±≈ümasƒ±nƒ± √∂nle
            var list = document.getElementById("resultsList");
            if(list.style.display === "block") list.style.display = "none";
            else this.showList();
        },

        showList: function() {
            var val = document.getElementById("searchBox").value.toLocaleLowerCase('tr'); // T√ºrk√ße karakter desteƒüi
            var list = document.getElementById("resultsList");
            list.innerHTML = "";
            
            var filtered = this.db.filter(i => {
                var matchText = i.c.toLowerCase().includes(val) || i.n.toLocaleLowerCase('tr').includes(val);
                var matchTab = this.filterTab === "ALL" || i.l === this.filterTab;
                return matchText && matchTab;
            });

            if(filtered.length === 0) { list.style.display="none"; return; }

            filtered.forEach(item => {
                var div = document.createElement("div");
                div.className = "res-item";
                var icon = item.l==="ROUTE"?"üõ£Ô∏è":item.l==="OA"?"üåâ":"üöá";
                div.innerHTML = `<div class="res-icon">${icon}</div><div><strong>${item.c}</strong><br>${item.n}</div>`;
                div.onmousedown = () => { this.selectItem(item); }; // mousedown √∂nemli
                list.appendChild(div);
            });
            list.style.display = "block";
        },

        filterList: function() { this.showList(); },

        selectItem: function(item) {
            this.selItem = item;
            document.getElementById("searchBox").value = item.c + " - " + item.n.split(" / ")[0];
            document.getElementById("resultsList").style.display = "none";
            this.renderCard();
        },

        renderCard: function() {
            var item = this.selItem;
            var card = document.getElementById("analysisCard");
            var dieselP = parseFloat(document.getElementById("dieselPrice").value.replace(',','.'));
            var euroR = parseFloat(document.getElementById("euroRate").value.replace(',','.'));

            document.getElementById("acName").innerText = item.n;
            document.getElementById("acCode").innerText = "KOD: " + item.c + " | Bƒ∞Rƒ∞M: " + item.u;
            card.style.display = "block";
            document.getElementById("calcSec").style.display = "block";

            var htmlContent = "";

            // 1. DQE Bƒ∞LGƒ∞Sƒ∞
            var dqeTotalDZD = item.d + (item.e * euroR);
            htmlContent += `
                <div style="margin-bottom:15px; border-bottom:1px dashed #eee; padding-bottom:10px;">
                    <span class="ac-label">S√∂zle≈üme Fiyatƒ± (DQE):</span><br>
                    <span class="ac-val" style="font-size:16px;">${this.fmt(item.d)} DZD + ${this.fmt(item.e)} ‚Ç¨</span>
                    <br><small style="color:#007aff">Toplam: ${this.fmt(dqeTotalDZD)} DZD</small>
                </div>`;

            // 2. ANALƒ∞Z VARSA
            if (item.a) {
                var a = item.a;
                var dailyCostEUR = a.m + a.l; 
                var dailyFuelDZD = a.f * dieselP; 
                
                var unitMachineLaborEUR = dailyCostEUR / a.prod;
                var unitFuelDZD = dailyFuelDZD / a.prod;
                var finalUnitCostEUR = unitMachineLaborEUR + a.mat + (unitFuelDZD / euroR);
                var finalUnitCostDZD = finalUnitCostEUR * euroR;

                htmlContent += `
                    <div class="ac-row"><span class="ac-label">G√ºnl√ºk ƒ∞malat:</span> <span class="ac-val">${a.prod} ${item.u}</span></div>
                    <div class="ac-row"><span class="ac-label">G√ºnl√ºk Yakƒ±t (${a.f} Lt):</span> <span class="ac-val">${this.fmt(dailyFuelDZD)} DZD</span></div>
                    <div class="ac-row"><span class="ac-label">G√ºnl√ºk Makine+ƒ∞≈ü√ßi:</span> <span class="ac-val">${this.fmt(dailyCostEUR)} ‚Ç¨</span></div>
                    
                    <div class="ac-total" style="background:#eaf3ff; border-color:#007aff;">
                        <span class="ac-total-label">ANALƒ∞Z MALƒ∞YETƒ∞</span>
                        <span class="ac-total-val" style="color:#007aff">${this.fmt(finalUnitCostDZD)} DZD</span>
                        <small>(${this.fmt(finalUnitCostEUR)} ‚Ç¨)</small>
                    </div>
                `;
            } else {
                 htmlContent += `<div style="text-align:center; color:#999; font-size:12px;">(Bu kalem i√ßin analiz verisi yok)</div>`;
            }
            
            document.querySelector(".ac-body").innerHTML = htmlContent;
            document.getElementById("qtyIn").value = "";
            document.getElementById("grandTotalDisplay").innerText = "0 DZD";
        },

        recalcAnalysis: function() { if(this.selItem) this.renderCard(); },

        calculateTotal: function() {
            if(!this.selItem) return;
            var q = parseFloat(document.getElementById("qtyIn").value);
            var r = parseFloat(document.getElementById("euroRate").value);
            if(q>0) {
                 var item = this.selItem;
                 var unitPrice = item.d + (item.e * r);
                 var total = q * unitPrice;
                 document.getElementById("grandTotalDisplay").innerText = this.fmt(total) + " DZD";
            }
        },

        fmt: function(n) { return n.toLocaleString('tr-TR', {minimumFractionDigits: 2, maximumFractionDigits: 2}); },

        quotes: [
            {t:"ƒ∞≈üleyen demir ƒ±≈üƒ±ldar.", a:"Atas√∂z√º"},
            {t:"Yol medeniyettir.", a:"Atas√∂z√º"},
            {t:"≈ûantiyede g√ºvenlik, hƒ±zdan √∂nce gelir.", a:"Kural"}
        ],
        newQuote: function() {
            var r = this.quotes[Math.floor(Math.random() * this.quotes.length)];
            document.getElementById("qText").innerText = '"' + r.t + '"';
            document.getElementById("qAuthor").innerText = "‚Äî " + r.a;
        }
    };

    // BA≈ûLANGI√á
    document.getElementById("passInput").addEventListener("keypress", function(e){ if(e.key==="Enter") app.login(); });
    
    if(localStorage.getItem("master_auth_v10") === "ok") {
        document.getElementById("loginOverlay").style.display = "none";
        document.getElementById("appContainer").style.display = "block";
        app.newQuote();
    }
    
    // Tƒ±klama ile liste kapat (Sadece dƒ±≈üarƒ± tƒ±klandƒ±ƒüƒ±nda)
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.search-container')) document.getElementById("resultsList").style.display = "none";
    });

</script>

</body>
</html>
