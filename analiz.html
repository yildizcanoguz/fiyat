<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MALƒ∞YET ANALƒ∞Zƒ∞ (14 DOSYA)</title>
    <style>
        /* --- MODERN VE TEMƒ∞Z TASARIM --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; padding: 0; background-color: #f4f6f8; color: #333; 
            height: 100vh; overflow: hidden;
        }

        /* Gƒ∞Rƒ∞≈û EKRANI */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #f4f6f8 0%, #dbe2e8 100%);
            z-index: 99999; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .login-box {
            background: white; padding: 40px 30px; border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1); width: 85%; max-width: 350px;
            text-align: center; border: 1px solid #fff;
        }
        .login-input {
            width: 100%; padding: 15px; margin: 20px 0; border: 2px solid #e1e4e8; 
            border-radius: 12px; font-size: 24px; text-align: center; letter-spacing: 5px; 
            background: #f9fbfd; transition: all 0.3s;
        }
        .login-input:focus { border-color: #007aff; background: #fff; }
        .login-btn {
            width: 100%; padding: 15px; background: #007aff; color: white;
            border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer;
        }

        /* ANA EKRAN */
        #appContainer {
            display: none; max-width: 600px; margin: 0 auto; height: 100%; overflow-y: auto;
            padding: 15px; padding-bottom: 100px;
        }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .app-title { font-size: 18px; font-weight: 900; color: #007aff; text-transform: uppercase; }
        .logout-btn { background: #ff3b30; color: white; border: none; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: bold; cursor: pointer; }

        /* PARAMETRELER */
        .params-panel {
            background: #fff; padding: 15px; border-radius: 16px; margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.03); border: 1px solid #e1e4e8;
            display: flex; gap: 10px;
        }
        .param-group { flex: 1; text-align: center; }
        .param-label { font-size: 11px; color: #007aff; font-weight: 800; text-transform: uppercase; margin-bottom: 5px; display: block; }
        .param-input { width: 100%; padding: 10px; border: 2px solid #e1e4e8; border-radius: 10px; font-size: 16px; font-weight: 700; text-align: center; background: #f9fbfd; color: #333; }

        /* DROPBOX MEN√ú */
        .search-container { position: relative; margin-bottom: 20px; z-index: 1000; }
        .search-box-wrapper {
            display: flex; align-items: center; background: #fff; border: 2px solid #007aff;
            border-radius: 14px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,122,255,0.1);
        }
        
        .search-input { 
            flex: 1; padding: 16px; border: none; font-size: 15px; font-weight: 600; outline: none;
        }
        .dropdown-btn {
            padding: 16px 20px; background: #f0f2f5; color: #007aff; font-size: 12px; cursor: pointer;
            border-left: 1px solid #e1e4e8; font-weight: 800; user-select: none;
        }
        .dropdown-btn:active { background: #e0e6ed; }

        .results-list {
            display: none; position: absolute; top: 110%; left: 0; right: 0;
            background: white; border-radius: 14px; max-height: 350px; overflow-y: auto;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2); border: 1px solid #e1e4e8; padding: 5px;
        }
        .res-item { padding: 14px; border-radius: 8px; cursor: pointer; border-bottom: 1px solid #f9f9f9; display: flex; align-items: center; }
        .res-item:active { background: #f2f7ff; }
        .res-icon { width: 32px; height: 32px; border-radius: 8px; background: #eaf3ff; color: #007aff; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-size: 16px; font-weight: bold; flex-shrink: 0; }

        /* ANALƒ∞Z KARTI */
        .analysis-card {
            background: #fff; border-radius: 20px; overflow: hidden; margin-top: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08); display: none; margin-bottom: 30px;
            border: 1px solid #e1e4e8;
        }
        .ac-header { background: linear-gradient(135deg, #007aff, #005ecb); color: white; padding: 15px 20px; }
        .ac-title { font-size: 18px; font-weight: 800; margin: 0; }
        
        .ac-body { padding: 20px; }
        .ac-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 13px; border-bottom: 1px dashed #eee; padding-bottom: 8px; }
        .ac-label { color: #666; font-weight: 600; }
        .ac-val { font-weight: 700; color: #333; }
        
        .ac-total { margin-top: 15px; background: #f8f9fa; padding: 15px; border-radius: 12px; text-align: center; border: 2px solid #007aff; }
        .ac-total-label { font-size: 11px; color: #888; text-transform: uppercase; font-weight: 800; letter-spacing: 1px; }
        .ac-total-val { font-size: 24px; font-weight: 900; color: #007aff; display: block; margin-top: 5px; }

        /* HESAPLAMA */
        .calc-area { margin-top: 20px; display: none; }
        .calc-input { width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 12px; font-size: 16px; font-weight: bold; text-align: center; }
        .grand-result { text-align: center; font-size: 22px; font-weight: 900; color: #333; margin-top: 15px; padding-top: 15px; border-top: 2px dashed #ddd; }

        /* G√úN√úN S√ñZ√ú */
        .quote-card { margin-top: 40px; padding: 20px; background: white; border-radius: 16px; text-align: center; border-bottom: 4px solid #007aff; cursor: pointer; color: #555; }
        .q-text { font-size: 13px; font-style: italic; margin-bottom: 8px; line-height: 1.4; }
        .q-author { font-size: 10px; font-weight: 800; color: #007aff; text-transform: uppercase; }

    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-box">
        <h2 style="margin:0 0 10px 0; color:#2c3e50;">MALƒ∞YET ANALƒ∞Zƒ∞</h2>
        <p style="color:#666; font-size:13px; margin-bottom:20px;">Gƒ∞Rƒ∞≈û / CONNEXION</p>
        <input type="password" id="passInput" class="login-input" placeholder="****" inputmode="numeric">
        <button class="login-btn" onclick="app.login()">Gƒ∞Rƒ∞≈û YAP</button>
        <p id="errorMsg" style="color:#ff3b30; display:none; margin-top:15px; font-weight:bold; font-size:13px;">Hatalƒ± ≈ûifre!</p>
    </div>
</div>

<div id="appContainer">
    <div class="header">
        <div class="app-title">PROJE ANALƒ∞Z üìä</div>
        <button class="logout-btn" onclick="app.logout()">√áIKI≈û</button>
    </div>

    <div class="params-panel">
        <div class="param-group">
            <label class="param-label">Mazot (DZD)</label>
            <input type="number" id="dieselPrice" class="param-input" value="29.01" onkeyup="app.recalcAnalysis()">
        </div>
        <div class="param-group">
            <label class="param-label">Euro Kuru</label>
            <input type="number" id="euroRate" class="param-input" value="107.31" onkeyup="app.recalcAnalysis()">
        </div>
    </div>

    <label style="font-weight:700; color:#555; margin-left:5px; margin-bottom:5px; display:block;">ƒ∞≈ü Kalemi Se√ß / S√©lectionnez:</label>

    <div class="search-container">
        <div class="search-box-wrapper">
            <input type="text" id="searchBox" class="search-input" placeholder="Poz Ara / Rechercher..." onkeyup="app.filterList()" onfocus="app.showList()" autocomplete="off">
            <div class="dropdown-btn" onclick="app.toggleList(event)">‚ñº Lƒ∞STE</div>
        </div>
        <div id="resList" class="results-list"></div>
    </div>

    <div id="analysisCard" class="analysis-card">
        <div class="ac-header">
            <h3 class="ac-title" id="acName">...</h3>
        </div>
        <div class="ac-body"></div>
    </div>

    <div id="calcSec" class="calc-area">
        <label class="param-label" style="text-align:left;">Mƒ∞KTAR Gƒ∞Rƒ∞Nƒ∞Z (Quantit√©):</label>
        <input type="number" id="qtyIn" class="calc-input" placeholder="0" onkeyup="app.calculateTotal()">
        <div class="grand-result" id="grandTotalDisplay">0 DZD</div>
    </div>

    <div class="quote-card" onclick="app.newQuote()">
        <div style="font-size:24px; color:#ccc; margin-top:-10px;">‚ùù</div>
        <p id="qText" class="q-text">...</p>
        <div id="qAuthor" class="q-author"></div>
    </div>
</div>

<script>
    var app = {
        PASS: "1907",
        selItem: null,
        
        // --- SADECE SENƒ∞N G√ñNDERDƒ∞ƒûƒ∞N 14 DOSYA ---
        // Veri Yapƒ±sƒ±: n:ƒ∞sim, u:Birim, prod:G√ºnl√ºk √úretim, fuel:G√ºnl√ºk Yakƒ±t(Lt), fixed:G√ºnl√ºk Sabit Gider(Euro)
        // Not: Sabit Gider (Makine Amortisman + ƒ∞≈ü√ßilik + Malzeme vs.) yakla≈üƒ±k hesaplanmƒ±≈ütƒ±r.
        db: [
            {n:"Kazƒ± ƒ∞≈üi (Genel) / D√©blai", u:"m3", prod:3600, fuel:1200, fixed:850}, // Kazƒ±.csv
            {n:"Dolgu ƒ∞≈üi / Remblai", u:"m3", prod:1800, fuel:400, fixed:600}, // Dolgu.csv
            {n:"Shotcrete (P√ºsk√ºrtme Beton)", u:"m3", prod:80, fuel:150, fixed:1200}, // Shotcrete.csv (Malzeme dahil pahalƒ±)
            {n:"Ankraj (Pasif) / Tirants", u:"ml", prod:100, fuel:80, fixed:450}, // Ankraj.csv
            {n:"Hasƒ±r √áelik / Treillis Soud√©s", u:"Ton", prod:12, fuel:20, fixed:600}, // Hasƒ±r √áelik.csv
            {n:"Barbakan / Barbacane PVC", u:"ml", prod:150, fuel:5, fixed:100}, // Barbakan.csv
            {n:"Ankraj Testi / Essai Tirants", u:"Adet", prod:6, fuel:20, fixed:200}, // Ankraj Testi.csv
            {n:"Anrochman (Ta≈ü Dolgu)", u:"m3", prod:780, fuel:250, fixed:500}, // Anrochman.csv
            {n:"Riprap (Ta≈ü Tahkimat)", u:"m3", prod:120, fuel:60, fixed:300}, // riprap.csv
            {l:"GNT (Temel Malzemesi)", u:"m3", prod:96, fuel:10, fixed:150}, // gnt.csv
            {n:"CDF (Form Tabakasƒ±)", u:"m3", prod:960, fuel:300, fixed:550}, // cdf.csv
            {n:"Toprakarme / Terre Arm√©e", u:"m2", prod:1000, fuel:400, fixed:800}, // Toprekarme.csv
            {n:"Nebati Sƒ±yƒ±rma / D√©capage", u:"m3", prod:192, fuel:50, fixed:150}, // nebati.csv
            {n:"√áevre D√ºzenlemesi / Plantation", u:"m2", prod:1000, fuel:20, fixed:200} // √ßevre d√ºzenlemesi.csv
        ],

        // --- 1. FONKSƒ∞YONLAR ---
        login: function() {
            var val = document.getElementById("passInput").value;
            if(val.trim() === this.PASS) {
                document.getElementById("loginOverlay").style.display = "none";
                document.getElementById("appContainer").style.display = "block";
                localStorage.setItem("master_v11", "ok");
                this.newQuote();
            } else {
                document.getElementById("errorMsg").style.display = "block";
            }
        },

        logout: function() {
            localStorage.removeItem("master_v11");
            location.reload();
        },

        toggleList: function(event) {
            if(event) event.stopPropagation(); 
            var list = document.getElementById("resultsList");
            if(list.style.display === "block") list.style.display = "none";
            else this.showList();
        },

        showList: function() {
            var val = document.getElementById("searchBox").value.toLocaleLowerCase('tr');
            var list = document.getElementById("resultsList");
            list.innerHTML = "";
            
            var filtered = this.db.filter(i => i.n.toLocaleLowerCase('tr').includes(val));

            filtered.forEach(item => {
                var div = document.createElement("div");
                div.className = "res-item";
                div.innerHTML = `<div class="res-icon">‚û§</div><div><strong>${item.n}</strong></div>`;
                div.onmousedown = () => { this.selectItem(item); };
                list.appendChild(div);
            });
            list.style.display = "block";
        },

        filterList: function() { this.showList(); },

        selectItem: function(item) {
            this.selItem = item;
            document.getElementById("searchBox").value = item.n;
            document.getElementById("resultsList").style.display = "none";
            this.renderCard();
        },

        renderCard: function() {
            var item = this.selItem;
            var card = document.getElementById("analysisCard");
            var dieselP = parseFloat(document.getElementById("dieselPrice").value.replace(',','.'));
            var euroR = parseFloat(document.getElementById("euroRate").value.replace(',','.'));

            document.getElementById("acName").innerText = item.n;
            card.style.display = "block";
            document.getElementById("calcSec").style.display = "block";

            // ANALƒ∞Z HESABI
            // G√ºnl√ºk Toplam = (Yakƒ±t Lt * Mazot Fiyatƒ± / Euro Kuru) + Sabit Giderler
            // Birim Fiyat = G√ºnl√ºk Toplam / G√ºnl√ºk √úretim
            
            var dailyFuelCostEUR = (item.fuel * dieselP) / euroR;
            var totalDailyEUR = dailyFuelCostEUR + item.fixed;
            var unitPriceEUR = totalDailyEUR / item.prod;
            var unitPriceDZD = unitPriceEUR * euroR;

            this.currentUnitPrice = unitPriceDZD; // Global kaydet

            document.querySelector(".ac-body").innerHTML = `
                <div class="ac-row"><span class="ac-label">G√ºnl√ºk √úretim:</span> <span class="ac-val">${item.prod} ${item.u}</span></div>
                <div class="ac-row"><span class="ac-label">G√ºnl√ºk Yakƒ±t:</span> <span class="ac-val">${item.fuel} Lt</span></div>
                <div class="ac-row"><span class="ac-label">Sabit Gider (Makine+ƒ∞≈ü√ßi):</span> <span class="ac-val">${item.fixed} ‚Ç¨</span></div>
                
                <div class="ac-total" style="background:#eaf3ff; border-color:#007aff;">
                    <span class="ac-total-label">ANALƒ∞Z EDƒ∞LEN Bƒ∞Rƒ∞M Fƒ∞YAT</span>
                    <span class="ac-total-val" style="color:#007aff">${this.fmt(unitPriceDZD)} DZD</span>
                    <small>(${this.fmt(unitPriceEUR)} ‚Ç¨)</small>
                </div>
            `;
            
            document.getElementById("qtyIn").value = "";
            document.getElementById("grandTotalDisplay").innerText = "0 DZD";
        },

        recalcAnalysis: function() { if(this.selItem) this.renderCard(); },

        calculateTotal: function() {
            if(!this.selItem) return;
            var q = parseFloat(document.getElementById("qtyIn").value);
            if(q>0) {
                 var total = q * this.currentUnitPrice;
                 document.getElementById("grandTotalDisplay").innerText = this.fmt(total) + " DZD";
            }
        },

        fmt: function(n) { return n.toLocaleString('tr-TR', {minimumFractionDigits: 2, maximumFractionDigits: 2}); },

        quotes: [
            {t:"ƒ∞≈üleyen demir ƒ±≈üƒ±ldar.", a:"Atas√∂z√º"},
            {t:"Yol medeniyettir.", a:"Atas√∂z√º"},
            {t:"≈ûantiyede g√ºvenlik, hƒ±zdan √∂nce gelir.", a:"Kural"}
        ],
        newQuote: function() {
            var r = this.quotes[Math.floor(Math.random() * this.quotes.length)];
            document.getElementById("qText").innerText = '"' + r.t + '"';
            document.getElementById("qAuthor").innerText = "‚Äî " + r.a;
        }
    };

    // --- BA≈ûLANGI√á ---
    document.getElementById("passInput").addEventListener("keypress", function(e){ if(e.key==="Enter") app.login(); });
    
    if(localStorage.getItem("master_v11") === "ok") {
        document.getElementById("loginOverlay").style.display = "none";
        document.getElementById("appContainer").style.display = "block";
        app.newQuote();
    }
    
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.search-container')) document.getElementById("resultsList").style.display = "none";
    });

</script>

</body>
</html>
